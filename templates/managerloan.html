<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manager Loan Approval Dashboard - DigiBank</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    :root{
      --brand:#0B4D83;
      --accent:#97144D;
      --bg-soft:#f4f6fb;
      --card:#ffffff;
      --ink:#1f2933;
      --muted:#6b7a90;
      --border:#dde3f0;
      --success:#1abc9c;
      --warning:#f39c12;
      --danger:#e74c3c;
      --info:#3498db;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:'Segoe UI',system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      background:radial-gradient(circle at top left,#e3f2fd 0,#f7f8fc 40%,#eef3fb 100%);
      color:var(--ink);
    }

    .page-wrapper{
      min-height:100vh;
      padding:18px 16px;
    }

    .top-bar{
      max-width:1320px;
      margin:0 auto 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      flex-wrap:wrap;
    }

    .top-title{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .top-icon{
      width:40px;
      height:40px;
      border-radius:16px;
      background:linear-gradient(135deg,var(--brand),var(--accent));
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      box-shadow:0 4px 14px rgba(0,0,0,.20);
      font-size:20px;
    }

    .top-text h1{
      font-size:20px;
      margin:0;
    }

    .top-text span{
      font-size:12px;
      color:var(--muted);
    }

    .top-right{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .badge-pill{
      border-radius:999px;
      padding:6px 10px;
      font-size:11px;
      background:#eaf2ff;
      color:var(--brand);
      display:inline-flex;
      align-items:center;
      gap:6px;
    }

    .btn-outline-light{
      border-radius:999px;
      border:1px solid #d7e0f0;
      font-size:12px;
      padding:6px 10px;
      background:#fff;
      color:var(--ink);
    }
    .btn-outline-light i{font-size:13px;}

    .badge-status{
      border-radius:999px;
      padding:4px 10px;
      font-size:11px;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .badge-status.pending{background:#fff4e5;color:#b45f06;}
    .badge-status.in-review{background:#eaf2ff;color:#1d4ed8;}
    .badge-status.approved{background:#e6fffa;color:#047857;}
    .badge-status.rejected{background:#fee2e2;color:#b91c1c;}
    .badge-status.field-pending{background:#fef3c7;color:#92400e;}
    .badge-status.field-done{background:#e0f2fe;color:#1d4ed8;}

    /* Shell layout */
    .dash-shell{
      max-width:1320px;
      margin:0 auto;
      background:rgba(255,255,255,0.96);
      border-radius:16px;
      box-shadow:0 14px 40px rgba(15,30,60,.16);
      display:grid;
      grid-template-columns:minmax(280px,350px) minmax(0,1fr);
      gap:0;
      overflow:hidden;
      border:1px solid #dde4f2;
    }

    /* Left rail – Applications */
    .left-rail{
      background:linear-gradient(180deg,#f4f7ff,#eef3ff);
      border-right:1px solid #dde4f2;
      display:flex;
      flex-direction:column;
    }

    .left-rail-header{
      padding:14px 16px 10px;
      border-bottom:1px solid #dde4f2;
    }
    .left-rail-header h2{
      font-size:14px;
      margin:0 0 4px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .left-rail-header span{
      font-size:11px;
      color:var(--muted);
    }

    .pill-tabs{
      display:flex;
      gap:6px;
      margin-top:8px;
      flex-wrap:wrap;
    }
    .pill-tab{
      font-size:11px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid #c9d4f0;
      background:#fff;
      color:#4b5563;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
    }
    .pill-tab.active{
      background:var(--brand);
      color:#fff;
      border-color:var(--brand);
    }

    .search-box{
      padding:8px 16px 10px;
      border-bottom:1px solid #dde4f2;
    }
    .search-box .input-group{
      border-radius:999px;
      overflow:hidden;
      box-shadow:0 2px 6px rgba(15,30,60,.1);
    }
    .search-box input{
      border:none;
      font-size:12px;
      padding:8px 10px;
    }
    .search-box .input-group-text{
      border:none;
      background:#fff;
      font-size:13px;
      color:var(--muted);
    }

    .app-list{
      padding:8px 10px 10px;
      overflow-y:auto;
      max-height:calc(100vh - 190px);
    }
    .app-card{
      border-radius:10px;
      background:#ffffff;
      padding:10px 10px 8px;
      margin-bottom:8px;
      border:1px solid transparent;
      cursor:pointer;
      transition:all 0.15s;
      position:relative;
    }
    .app-card:hover{
      box-shadow:0 3px 10px rgba(15,30,60,.12);
      transform:translateY(-1px);
      border-color:#c4d0f3;
    }
    .app-card.active{
      border-color:var(--brand);
      box-shadow:0 0 0 1px rgba(11,77,131,0.3);
      background:#f7fbff;
    }

    .app-row-1{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:4px;
      margin-bottom:4px;
    }
    .app-name{
      font-size:13px;
      font-weight:600;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .app-meta{
      font-size:11px;
      color:var(--muted);
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .app-amount{
      font-size:13px;
      font-weight:600;
      color:#1f2933;
      text-align:right;
    }
    .app-amount span{
      font-size:11px;
      color:#6b7a90;
      font-weight:400;
      margin-left:4px;
    }

    .app-tags{
      display:flex;
      flex-wrap:wrap;
      gap:4px;
      margin-top:4px;
      font-size:10px;
    }
    .tag-chip{
      padding:2px 7px;
      border-radius:999px;
      background:#eef2ff;
      color:#4c51bf;
    }
    .tag-chip.loan-home{background:#e3f2fd;color:#0b4d83;}
    .tag-chip.loan-business{background:#fff3e0;color:#b75c00;}
    .tag-chip.loan-personal{background:#fce7f3;color:#9d174d;}
    .tag-chip-risk-low{background:#e6fffa;color:#047857;}
    .tag-chip-risk-med{background:#fef3c7;color:#92400e;}
    .tag-chip-risk-high{background:#fee2e2;color:#b91c1c;}

    /* Right panel */
    .right-panel{
      background:#f9fafc;
      display:flex;
      flex-direction:column;
    }

    .right-head{
      padding:14px 16px 10px;
      border-bottom:1px solid #dde4f2;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .right-head-left{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .right-head-left h2{
      font-size:16px;
      margin:0;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .right-head-left span{
      font-size:11px;
      color:var(--muted);
    }
    .right-head-tags{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      margin-top:2px;
    }

    .right-head-actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn-sm{
      font-size:11px;
      padding:6px 11px;
      border-radius:999px;
      border:none;
      display:inline-flex;
      align-items:center;
      gap:5px;
      cursor:pointer;
      transition:.15s;
    }
    .btn-approve{background:var(--success);color:#fff;}
    .btn-approve:hover{box-shadow:0 3px 8px rgba(39,174,96,.35);}
    .btn-sendback{background:#fff7e5;color:#a56600;border:1px solid #f2cf81;}
    .btn-reject{background:#fee2e2;color:#b91c1c;border:1px solid #fecaca;}
    .btn-save{background:#e0ecff;color:#1d4ed8;border:1px solid #bfdbfe;}

    .right-body{
      padding:12px 14px 16px;
      overflow-y:auto;
      max-height:calc(100vh - 120px);
    }

    .grid-2{
      display:grid;
      grid-template-columns:1.8fr 1.4fr;
      gap:10px;
    }

    .card-box{
      background:#ffffff;
      border-radius:12px;
      border:1px solid #dde4f2;
      padding:10px 11px 9px;
      margin-bottom:10px;
    }
    .card-box-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:6px;
    }
    .card-box-title{
      font-size:13px;
      font-weight:600;
      display:flex;
      align-items:center;
      gap:6px;
      color:#111827;
    }
    .card-box-title i{
      font-size:13px;
      color:var(--brand);
    }
    .pill-mini{
      font-size:10px;
      padding:2px 8px;
      border-radius:999px;
      background:#f3f4ff;
      color:#4c51bf;
    }

    .summary-list{
      list-style:none;
      padding:0;
      margin:0;
      font-size:12px;
    }
    .summary-list li{
      display:flex;
      justify-content:space-between;
      border-bottom:1px dashed #e2e8f0;
      padding:3px 0;
      gap:8px;
    }
    .summary-label{
      color:var(--muted);
    }
    .summary-value{
      font-weight:600;
      color:#111827;
      text-align:right;
    }

    .subtext{
      font-size:11px;
      color:var(--muted);
    }

    /* Pricing editor */
    .pricing-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      font-size:12px;
    }
    .pricing-col{
      flex:1 0 120px;
    }
    .pricing-label{
      font-size:11px;
      color:var(--muted);
    }
    .pricing-value{
      font-size:13px;
      font-weight:600;
    }
    .form-control-sm{
      font-size:12px;
      border-radius:999px;
      padding:4px 8px;
    }
    .badge-diff-pos{background:#e6fffa;color:#047857;border-radius:999px;padding:2px 7px;font-size:10px;}
    .badge-diff-neg{background:#fee2e2;color:#b91c1c;border-radius:999px;padding:2px 7px;font-size:10px;}

    /* Field verification */
    .field-block{
      font-size:12px;
    }
    .field-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:6px;
      align-items:center;
    }
    .field-row .form-select,
    .field-row .form-control{
      font-size:12px;
      padding:4px 8px;
      border-radius:999px;
    }
    .field-note{
      font-size:11px;
      color:var(--muted);
      margin-top:4px;
    }

    /* Decision panel */
    .decision-options{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      font-size:12px;
      margin-bottom:8px;
    }
    .decision-options .form-check{
      padding-left:0;
      display:flex;
      align-items:center;
      gap:4px;
    }
    .decision-options input[type="radio"]{
      margin:0;
    }

    .note-box{
      width:100%;
      border-radius:8px;
      border:1px solid #e2e8f0;
      font-size:12px;
      padding:6px 8px;
      min-height:60px;
      resize:vertical;
    }

    .small-label{
      font-size:11px;
      color:var(--muted);
      margin-top:3px;
    }

    /* Audit */
    .audit-list{
      list-style:none;
      padding:0;
      margin:0;
      font-size:11px;
    }
    .audit-list li{
      border-left:2px solid #d1d5db;
      padding:3px 0 3px 8px;
      margin-bottom:2px;
    }
    .audit-actions{
      font-weight:600;
    }

    /* Scrollbars */
    .app-list::-webkit-scrollbar,
    .right-body::-webkit-scrollbar{
      width:6px;
    }
    .app-list::-webkit-scrollbar-thumb,
    .right-body::-webkit-scrollbar-thumb{
      background:#cbd5f0;
      border-radius:999px;
    }

    @media (max-width:992px){
      .dash-shell{
        grid-template-columns:1fr;
      }
      .left-rail{
        max-height:360px;
        border-right:none;
        border-bottom:1px solid #dde4f2;
      }
      .app-list{
        max-height:230px;
      }
      .right-body{
        max-height:none;
      }
    }

    @media (max-width:576px){
      .top-bar{
        flex-direction:column;
        align-items:flex-start;
      }
      .right-head{
        flex-direction:column;
        align-items:flex-start;
      }
      .right-head-actions{
        justify-content:flex-start;
      }
      .grid-2{
        grid-template-columns:1fr;
      }
    }
  </style>
</head>
<body>
<div class="page-wrapper">

  <!-- Top bar -->
  <div class="top-bar">
    <div class="top-title">
      <div class="top-icon">
        <i class="bi bi-diagram-3"></i>
      </div>
      <div class="top-text">
        <h1>Manager Loan Approval Dashboard</h1>
        <span>Analyse risk, adjust pricing, manage field verification & approve loans.</span>
      </div>
    </div>

    <div class="top-right">
      <div class="badge-pill">
        <i class="bi bi-circle-fill" style="font-size:7px;color:#f97316;"></i>
        3 Awaiting Manager Decision
      </div>
      <button class="btn-outline-light">
        <i class="bi bi-graph-up-arrow"></i> Today: 4 Approved · 1 Rejected
      </button>
    </div>
  </div>

  <!-- Main shell -->
  <div class="dash-shell">

    <!-- LEFT: Applications needing manager action -->
    <aside class="left-rail">
      <div class="left-rail-header">
        <h2>
          Manager Queue
          <span class="badge-status pending">
            <i class="bi bi-exclamation-circle"></i> Pending 3
          </span>
        </h2>
        <span>Applications cleared by underwriting, pending your decision.</span>

        <div class="pill-tabs">
          <button class="pill-tab active"><i class="bi bi-inbox-fill"></i> All</button>
          <button class="pill-tab"><i class="bi bi-house"></i> Home</button>
          <button class="pill-tab"><i class="bi bi-briefcase"></i> Business</button>
          <button class="pill-tab"><i class="bi bi-person"></i> Personal</button>
        </div>
      </div>

      <div class="search-box">
        <div class="input-group input-group-sm">
          <span class="input-group-text"><i class="bi bi-search"></i></span>
          <input type="text" class="form-control" placeholder="Search name / app no / loan type">
        </div>
      </div>

      <div class="app-list">
        <!-- Example: Home Loan with Property asset -->
        <div class="app-card active" data-asset-type="property">
          <div class="app-row-1">
            <div>
              <div class="app-name">
                <i class="bi bi-person-circle text-primary"></i>
                <span>Himanshu Shelke</span>
              </div>
              <div class="app-meta">
                <span>#APP-2025-00128</span>
                <span>Cleared by UW: 16 Nov 2025, 12:05 PM</span>
              </div>
            </div>
            <div class="text-end">
              <div class="app-amount">₹ 25,00,000 <span>Home Loan</span></div>
              <span class="badge-status field-pending">
                <i class="bi bi-signpost-split"></i> Field visit required
              </span>
            </div>
          </div>
          <div class="app-tags">
            <span class="tag-chip loan-home">Home · Property</span>
            <span class="tag-chip">CIBIL: 752</span>
            <span class="tag-chip-risk-med">Risk: Medium</span>
            <span class="tag-chip">UW EMI: ₹26,840</span>
          </div>
        </div>

        <!-- Business Loan (no property) -->
        <div class="app-card" data-asset-type="none">
          <div class="app-row-1">
            <div>
              <div class="app-name">
                <i class="bi bi-person-circle text-primary"></i>
                <span>Arshad Shaikh</span>
              </div>
              <div class="app-meta">
                <span>#APP-2025-00130</span>
                <span>Cleared by UW: 15 Nov 2025, 04:56 PM</span>
              </div>
            </div>
            <div class="text-end">
              <div class="app-amount">₹ 18,00,000 <span>Business Loan</span></div>
              <span class="badge-status in-review">
                <i class="bi bi-eye"></i> Ready for decision
              </span>
            </div>
          </div>
          <div class="app-tags">
            <span class="tag-chip loan-business">Business · Unsecured</span>
            <span class="tag-chip">CIBIL: 708</span>
            <span class="tag-chip-risk-high">Risk: High</span>
          </div>
        </div>

        <!-- Personal Loan (no property) -->
        <div class="app-card" data-asset-type="none">
          <div class="app-row-1">
            <div>
              <div class="app-name">
                <i class="bi bi-person-circle text-primary"></i>
                <span>Jyoti Chougale</span>
              </div>
              <div class="app-meta">
                <span>#APP-2025-00129</span>
                <span>Cleared by UW: 16 Nov 2025, 10:22 AM</span>
              </div>
            </div>
            <div class="text-end">
              <div class="app-amount">₹ 8,00,000 <span>Personal Loan</span></div>
              <span class="badge-status in-review">
                <i class="bi bi-eye"></i> Ready for decision
              </span>
            </div>
          </div>
          <div class="app-tags">
            <span class="tag-chip loan-personal">Personal · Unsecured</span>
            <span class="tag-chip">CIBIL: 812</span>
            <span class="tag-chip-risk-low">Risk: Low</span>
          </div>
        </div>

        <!-- More cards from backend... -->
      </div>
    </aside>

    <!-- RIGHT: Manager analysis & decision -->
    <main class="right-panel">
      <!-- Header -->
      <div class="right-head">
        <div class="right-head-left">
          <h2>Loan Analysis & Approval</h2>
          <span>
            Selected: <strong>Himanshu Shelke – Home Loan</strong> · #APP-2025-00128
          </span>
          <div class="right-head-tags">
            <span class="badge-status in-review">
              <i class="bi bi-shield-check"></i> Underwriter Recommendation: APPROVE with 8.95%
            </span>
            <span class="badge-status field-pending" id="fieldStatusBadge">
              <i class="bi bi-signpost-2"></i> Field Verification: Pending assignment
            </span>
          </div>
        </div>

        <div class="right-head-actions">
          <button class="btn-sm btn-save" id="btnSavePricing">
            <i class="bi bi-floppy"></i> Save Pricing Changes
          </button>
          <button class="btn-sm btn-sendback">
            <i class="bi bi-arrow-return-left"></i> Send Back to Underwriting
          </button>
          <button class="btn-sm btn-reject">
            <i class="bi bi-x-circle"></i> Reject
          </button>
          <button class="btn-sm btn-approve" id="btnApprove">
            <i class="bi bi-check2-circle"></i> Approve & Sanction
          </button>
        </div>
      </div>

      <!-- Body -->
      <div class="right-body">
        <div class="grid-2">
          <!-- LEFT: Summary + Financials + Pricing -->
          <div>
            <!-- Application Summary -->
            <div class="card-box">
              <div class="card-box-header">
                <div class="card-box-title">
                  <i class="bi bi-person-badge"></i> Application Summary
                </div>
                <span class="pill-mini">Basic profile</span>
              </div>
              <ul class="summary-list">
                <li>
                  <span class="summary-label">Applicant</span>
                  <span class="summary-value">Himanshu Shelke</span>
                </li>
                <li>
                  <span class="summary-label">Loan Type</span>
                  <span class="summary-value">Home Loan – Property as collateral</span>
                </li>
                <li>
                  <span class="summary-label">Requested Amount</span>
                  <span class="summary-value">₹ 25,00,000</span>
                </li>
                <li>
                  <span class="summary-label">Tenure</span>
                  <span class="summary-value">180 Months (15 Years)</span>
                </li>
                <li>
                  <span class="summary-label">Employment</span>
                  <span class="summary-value">Salaried · 4.5 years · IT Company</span>
                </li>
                <li>
                  <span class="summary-label">Annual Income</span>
                  <span class="summary-value">₹ 9,60,000 (≈ ₹ 80,000 / month)</span>
                </li>
              </ul>
            </div>

            <!-- Financial Health & Risk (includes DTI) -->
            <div class="card-box">
              <div class="card-box-header">
                <div class="card-box-title">
                  <i class="bi bi-graph-up"></i> Financial Health & Risk
                </div>
                <span class="pill-mini">System & UW analysis</span>
              </div>
              <ul class="summary-list">
                <li>
                  <span class="summary-label">CIBIL Score</span>
                  <span class="summary-value"><strong>752</strong> (Good)</span>
                </li>
                <li>
                  <span class="summary-label">Existing EMIs</span>
                  <span class="summary-value">₹ 8,000 / month</span>
                </li>
                <li>
                  <span class="summary-label">Proposed EMI (Manager)</span>
                  <span class="summary-value" id="mgrEmiFH">₹ 26,840 / month</span>
                </li>
                <li>
                  <span class="summary-label">Debt-to-Income (DTI)</span>
                  <span class="summary-value" id="dtiValue">
                    43.6% – <strong style="color:#047857;">Low</strong>
                  </span>
                </li>
                <li>
                  <span class="summary-label">System Risk Band</span>
                  <span class="summary-value">
                    <span class="badge-status in-review">
                      <i class="bi bi-shield-half"></i> Medium Risk
                    </span>
                  </span>
                </li>
              </ul>
              <p class="subtext mt-1">
                <i class="bi bi-info-circle"></i>
                DTI = (Existing EMIs + Proposed EMI) / Monthly Income. Higher DTI &gt; 45% indicates elevated risk.
              </p>
            </div>

            <!-- Pricing / Interest Rate Editor -->
            <div class="card-box">
              <div class="card-box-header">
                <div class="card-box-title">
                  <i class="bi bi-cash-stack"></i> Pricing & Interest Decision
                </div>
                <span class="pill-mini">Manager override allowed</span>
              </div>

              <div class="pricing-row mb-1">
                <div class="pricing-col">
                  <div class="pricing-label">Underwriter Recommended Rate</div>
                  <div class="pricing-value" id="uwRate">8.95% p.a.</div>
                  <div class="subtext">Based on system and UW assessment.</div>
                </div>
                <div class="pricing-col">
                  <div class="pricing-label">Manager Final Rate (%)</div>
                  <input type="number" class="form-control form-control-sm" id="mgrRate"
                         min="7.0" max="18.0" step="0.05" value="8.95">
                  <div id="rateDiffBadge" class="mt-1" style="font-size:11px;"></div>
                </div>
              </div>

              <div class="pricing-row mt-2">
                <div class="pricing-col">
                  <div class="pricing-label">Final EMI (Manager)</div>
                  <div class="pricing-value" id="mgrEmi">₹ 26,840</div>
                </div>
                <div class="pricing-col">
                  <div class="pricing-label">Difference vs UW EMI</div>
                  <div class="pricing-value" id="emiDiff">₹ 0</div>
                </div>
              </div>

              <p class="subtext mt-2">
                <i class="bi bi-exclamation-triangle"></i>
                Try to keep DTI ideally below 40%. Above 45% will be highlighted as higher risk.
              </p>
            </div>
          </div>

          <!-- RIGHT: Asset, Field Verification, Decision, Audit -->
          <div>
            <!-- Collateral / Asset -->
            <div class="card-box">
              <div class="card-box-header">
                <div class="card-box-title">
                  <i class="bi bi-house-door"></i> Collateral / Asset Details
                </div>
                <span class="pill-mini">Property / Land / Others</span>
              </div>
              <ul class="summary-list">
                <li>
                  <span class="summary-label">Asset Type</span>
                  <span class="summary-value" id="assetTypeLabel">Residential Property</span>
                </li>
                <li>
                  <span class="summary-label">Property Value (Builder Agreement)</span>
                  <span class="summary-value">₹ 45,00,000</span>
                </li>
                <li>
                  <span class="summary-label">Requested LTV (Loan / Value)</span>
                  <span class="summary-value">56% (Within internal limit & RBI guideline)</span>
                </li>
                <li>
                  <span class="summary-label">Location</span>
                  <span class="summary-value">Pune – Bavdhan</span>
                </li>
              </ul>
              <p class="subtext mt-1">
                <i class="bi bi-info-circle"></i>
                For Property / Land assets, field valuation and legal check are mandatory before final approval.
              </p>

              <!-- Field Verification Block (only when property/land) -->
              <div class="field-block mt-2" id="fieldVerificationBlock">
                <div class="d-flex justify-content-between align-items-center">
                  <span class="pricing-label">Field Verification</span>
                  <span class="badge-status field-pending" id="fieldBadgeSmall">
                    <i class="bi bi-signpost-split"></i> Pending
                  </span>
                </div>

                <div class="field-row mt-1">
                  <select class="form-select form-select-sm w-auto" id="agentSelect">
                    <option value="">Assign Field Agent</option>
                    <option value="AGT-01">AGT-01 · Mahesh Patil</option>
                    <option value="AGT-02">AGT-02 · Sneha Kulkarni</option>
                    <option value="AGT-03">AGT-03 · Ravi Shinde</option>
                  </select>
                  <button class="btn-sm btn-save" id="btnAssignAgent">
                    <i class="bi bi-person-plus"></i> Assign
                  </button>
                  <button class="btn-sm btn-outline-light" id="btnMarkFieldDone" style="display:none;">
                    <i class="bi bi-check2-square"></i> Mark Verified
                  </button>
                </div>

                <div class="field-note" id="fieldNote">
                  No agent assigned yet. Manager must assign a field agent for site visit & valuation.
                </div>
              </div>
            </div>

            <!-- Decision Panel -->
            <div class="card-box">
              <div class="card-box-header">
                <div class="card-box-title">
                  <i class="bi bi-clipboard-check"></i> Final Decision & Sanction
                </div>
                <span class="pill-mini">Manager action</span>
              </div>

              <div class="decision-options mb-2">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="decision" id="decApprove" value="approve" checked>
                  <label class="form-check-label" for="decApprove">Approve</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="decision" id="decReject" value="reject">
                  <label class="form-check-label" for="decReject">Reject</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="decision" id="decSendBack" value="sendback">
                  <label class="form-check-label" for="decSendBack">Send Back to Underwriting</label>
                </div>
              </div>

              <div id="approveFields">
                <div class="mb-2">
                  <label class="pricing-label">Sanctioned Amount (₹)</label>
                  <input type="number" class="form-control form-control-sm" id="sanctionAmount"
                         value="2500000" min="100000">
                </div>
                <div class="mb-2">
                  <label class="pricing-label">Final Tenure (Months)</label>
                  <input type="number" class="form-control form-control-sm" id="finalTenure"
                         value="180" min="12" max="360">
                </div>
                <div class="small-label">
                  <i class="bi bi-info-circle"></i>
                  Sanction note will use Manager Rate, Sanctioned Amount and Final Tenure.
                </div>
              </div>

              <div class="mt-2">
                <label class="pricing-label">Manager Remarks (visible to underwriting & audit)</label>
                <textarea class="note-box" id="mgrRemarks"
                          placeholder="Mention reasons for any rate change, DTI deviations, and conditions for approval (if any)."></textarea>
              </div>
              <div class="small-label">
                <i class="bi bi-shield-lock"></i>
                Decision, rate changes, DTI and remarks will be logged for audit.
              </div>
            </div>

            <!-- Audit Trail -->
            <div class="card-box">
              <div class="card-box-header">
                <div class="card-box-title">
                  <i class="bi bi-clock-history"></i> Audit Trail
                </div>
              </div>
              <ul class="audit-list">
                <li>
                  <div class="audit-actions">Underwriter · APPROVE @ 8.95%</div>
                  <div>16 Nov 2025, 12:05 PM · Docs verified, recommended approval.</div>
                </li>
                <li>
                  <div class="audit-actions">System</div>
                  <div>Risk score calculated: Medium · DTI within bank policy at UW rate.</div>
                </li>
                <li id="auditMgrAction" style="display:none;">
                  <!-- Manager action will be inserted here via JS -->
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {

    /* -------- Left side: card selection (demo only) ---------- */
    const appCards = document.querySelectorAll('.app-card');
    appCards.forEach(card => {
      card.addEventListener('click', () => {
        appCards.forEach(c => c.classList.remove('active'));
        card.classList.add('active');

        // In real app: load this application's data from backend.
        const assetType = card.getAttribute('data-asset-type');
        setAssetType(assetType);
      });
    });

    function setAssetType(assetType){
      const assetLabel = document.getElementById('assetTypeLabel');
      const fieldBlock = document.getElementById('fieldVerificationBlock');
      const fieldStatusBadge = document.getElementById('fieldStatusBadge');

      if(assetType === 'property' || assetType === 'land'){
        assetLabel.textContent = assetType === 'property' ? 'Residential Property' : 'Land';
        fieldBlock.style.display = 'block';
        fieldStatusBadge.style.display = 'inline-flex';
      }else{
        assetLabel.textContent = 'No collateral / unsecured';
        fieldBlock.style.display = 'none';
        fieldStatusBadge.style.display = 'none';
      }
    }

    // Initialize from first active card
    const firstActive = document.querySelector('.app-card.active');
    if(firstActive){
      setAssetType(firstActive.getAttribute('data-asset-type'));
    }

    /* -------- Pricing / EMI + DTI calculator ---------- */

    const mgrRateInput   = document.getElementById('mgrRate');
    const uwEmiElement   = document.getElementById('uwEmiValue');
    const mgrEmiElement  = document.getElementById('mgrEmi');
    const mgrEmiFH       = document.getElementById('mgrEmiFH');
    const emiDiffElement = document.getElementById('emiDiff');
    const diffBadge      = document.getElementById('rateDiffBadge');
    const dtiElement     = document.getElementById('dtiValue');

    // Demo constants (these should come from backend)
    const loanAmountBase  = 2500000;    // 25 lakh
    const existingEmiBase = 8000;       // Existing monthly EMIs
    const monthlyIncome   = 80000;      // Monthly income

    function getTenureMonths(){
      return parseInt(document.getElementById('finalTenure').value || '180', 10);
    }

    function parseEmiText(text){
      return parseFloat(text.replace(/[₹,\s]/g,'') || '0');
    }

    function calcEmi(p, rateAnnual, nMonths){
      if(p <= 0 || rateAnnual <= 0 || nMonths <= 0){return 0;}
      const r = rateAnnual / 12 / 100;
      const emi = p * r * Math.pow(1 + r, nMonths) / (Math.pow(1 + r, nMonths) - 1);
      return emi;
    }

    function formatINR(val){
      return val.toLocaleString('en-IN', {minimumFractionDigits:2, maximumFractionDigits:2});
    }

    function updatePricing(){
      const mgrRate = parseFloat(mgrRateInput.value || '0');
      const tenure  = getTenureMonths();
      const uwEmi   = parseEmiText(uwEmiElement ? uwEmiElement.textContent : '26840');

      const mgrEmi  = calcEmi(loanAmountBase, mgrRate, tenure);

      // Update EMI displays
      mgrEmiElement.textContent = '₹ ' + formatINR(mgrEmi);
      mgrEmiFH.textContent      = '₹ ' + formatINR(mgrEmi) + ' / month';

      // EMI difference vs UW
      const diff   = mgrEmi - uwEmi;
      const diffAbs = Math.abs(diff);
      let diffText = '₹ ' + formatINR(diffAbs);

      if(diff > 0){
        emiDiffElement.textContent = '+ ' + diffText;
        diffBadge.innerHTML = '<span class="badge-diff-neg">Higher EMI vs UW</span>';
      }else if(diff < 0){
        emiDiffElement.textContent = '- ' + diffText;
        diffBadge.innerHTML = '<span class="badge-diff-pos">EMI benefit to customer</span>';
      }else{
        emiDiffElement.textContent = '₹ 0';
        diffBadge.innerHTML = '';
      }

      // ---- DTI Calculation ----
      const totalDebtMonthly = existingEmiBase + mgrEmi;
      let dti = 0;
      if(monthlyIncome > 0){
        dti = (totalDebtMonthly / monthlyIncome) * 100;
      }

      let riskLabel, color;
      if(dti <= 35){
        riskLabel = 'Low';
        color = '#047857';      // green
      }else if(dti <= 45){
        riskLabel = 'Medium';
        color = '#f59e0b';      // amber
      }else{
        riskLabel = 'High';
        color = '#b91c1c';      // red
      }

      dtiElement.innerHTML = dti.toFixed(1) + '% – <strong style="color:'+ color +';">' + riskLabel + '</strong>';
    }

    mgrRateInput.addEventListener('input', updatePricing);
    document.getElementById('finalTenure').addEventListener('input', updatePricing);
    updatePricing();

    /* -------- Field verification assignment flow ---------- */

    const agentSelect      = document.getElementById('agentSelect');
    const btnAssignAgent   = document.getElementById('btnAssignAgent');
    const btnMarkFieldDone = document.getElementById('btnMarkFieldDone');
    const fieldBadgeSmall  = document.getElementById('fieldBadgeSmall');
    const fieldStatusBadge = document.getElementById('fieldStatusBadge');
    const fieldNote        = document.getElementById('fieldNote');

    btnAssignAgent.addEventListener('click', () => {
      const val = agentSelect.value;
      if(!val){
        alert('Please select an agent to assign.');
        return;
      }
      fieldBadgeSmall.classList.remove('field-pending');
      fieldBadgeSmall.classList.add('in-review');
      fieldBadgeSmall.innerHTML = '<i class="bi bi-person-walking"></i> Visit Assigned';

      fieldStatusBadge.classList.remove('field-pending');
      fieldStatusBadge.classList.add('in-review');
      fieldStatusBadge.innerHTML = '<i class="bi bi-person-walking"></i> Field visit in progress';

      fieldNote.textContent = 'Field agent ' + agentSelect.options[agentSelect.selectedIndex].text + ' assigned. Awaiting verification report.';
      btnMarkFieldDone.style.display = 'inline-flex';

      alert('Field agent assigned successfully. In real system, task will be created for agent.');
    });

    btnMarkFieldDone.addEventListener('click', () => {
      fieldBadgeSmall.classList.remove('in-review');
      fieldBadgeSmall.classList.add('field-done');
      fieldBadgeSmall.innerHTML = '<i class="bi bi-check2-circle"></i> Verified';

      fieldStatusBadge.classList.remove('in-review','field-pending');
      fieldStatusBadge.classList.add('approved');
      fieldStatusBadge.innerHTML = '<i class="bi bi-check2-circle"></i> Field verification completed';

      fieldNote.textContent = 'Field verification report received. Valuation and legal check marked as satisfactory.';
      btnMarkFieldDone.style.display = 'none';

      alert('Field verification marked as completed.');
    });

    /* -------- Decision radio logic ---------- */

    const decApprove     = document.getElementById('decApprove');
    const decReject      = document.getElementById('decReject');
    const decSendBack    = document.getElementById('decSendBack');
    const approveFields  = document.getElementById('approveFields');

    function toggleDecisionFields(){
      if(decApprove.checked){
        approveFields.style.display = 'block';
      }else{
        approveFields.style.display = 'none';
      }
    }
    decApprove.addEventListener('change', toggleDecisionFields);
    decReject.addEventListener('change', toggleDecisionFields);
    decSendBack.addEventListener('change', toggleDecisionFields);
    toggleDecisionFields();

    /* -------- Save pricing / Approve buttons (front-end demo) ---------- */

    const btnSavePricing  = document.getElementById('btnSavePricing');
    const btnApprove      = document.getElementById('btnApprove');
    const auditMgrAction  = document.getElementById('auditMgrAction');

    btnSavePricing.addEventListener('click', () => {
      alert('Pricing changes saved. In real system this will update loan_pricing table.');
    });

    btnApprove.addEventListener('click', () => {
      const decision        = decApprove.checked ? 'Approve'
                               : decReject.checked ? 'Reject'
                               : 'Send Back';
      const assetType       = document.getElementById('assetTypeLabel').textContent;
      const fieldBlockVisible = document.getElementById('fieldVerificationBlock').style.display !== 'none';

      // If property/land and field not yet verified, warn manager
      if(fieldBlockVisible && !fieldStatusBadge.classList.contains('approved') && decision === 'Approve'){
        const proceed = confirm('Field verification is not marked as completed. Are you sure you want to approve?');
        if(!proceed) return;
      }

      const mgrRate   = mgrRateInput.value;
      const sancAmt   = document.getElementById('sanctionAmount').value;
      const tenure    = document.getElementById('finalTenure').value;
      const remarks   = document.getElementById('mgrRemarks').value || '(No remarks entered)';
      const dtiText   = dtiElement.innerText;

      let summary = 'Decision: ' + decision + '\\n' +
                    'Final Rate: ' + mgrRate + '% p.a.\\n' +
                    'Sanctioned Amount: ₹ ' + sancAmt + '\\n' +
                    'Tenure: ' + tenure + ' months\\n' +
                    'DTI: ' + dtiText + '\\n\\n' +
                    'Remarks:\\n' + remarks;

      alert('Manager decision recorded (demo):\\n\\n' + summary);

      // Add to audit trail (demo)
      const now    = new Date();
      const timeStr = now.toLocaleString();
      auditMgrAction.style.display = 'list-item';
      auditMgrAction.innerHTML =
        '<div class="audit-actions">Manager</div>' +
        '<div>' + timeStr + ' · ' + decision + ' @ ' + mgrRate +
        '% · Sanction ₹' + sancAmt + ' / ' + tenure +
        ' months · DTI: ' + dtiText + '.</div>';
    });
  });
</script>

</body>
</html>
