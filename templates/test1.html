<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Loan Approval Workflow - DigiBank Manager</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
        .timeline-step { display:inline-block; width:23%; text-align:center; padding:10px; border-bottom:4px solid #ccc; }
        .timeline-active { border-color:#0d6efd; font-weight:600; }
    </style>
</head>

<body style="background:#f5f5f5;">
<div class="container mt-4">
    <h2 class="text-center mb-4"><i class="bi bi-diagram-3"></i> Loan Approval Workflow</h2>

    <!-- EMI Calculator Modal -->
    <div class="modal fade" id="emiCalculatorModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">EMI Calculator</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <label>Loan Amount</label>
                    <input id="loanAmt" type="number" class="form-control mb-2">

                    <label>Rate of Interest (%)</label>
                    <input id="roi" type="number" step="0.1" class="form-control mb-2">

                    <label>Tenure (Months)</label>
                    <input id="months" type="number" class="form-control mb-3">

                    <button class="btn btn-primary w-100" onclick="calculateEMI()">Calculate EMI</button>
                    <div class="alert alert-info mt-3 d-none" id="emiResult"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Valuation Modal -->
    <div class="modal fade" id="valuationModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Property Valuation Submission</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p><b>Loan ID:</b> <span id="valLoanId"></span></p>

                    <label>Property Type</label>
                    <select class="form-select mb-2">
                        <option>Home</option>
                        <option>Plot</option>
                        <option>Commercial</option>
                    </select>

                    <label>Market Value (₹)</label>
                    <input type="number" class="form-control mb-2">

                    <label>Valuation Report</label>
                    <input type="file" class="form-control mb-3">

                    <button class="btn btn-primary w-100">Submit Valuation</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loan Table -->
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Loan Requests</h5>
        </div>

        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-hover text-center align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>Customer</th>
                            <th>Type</th>
                            <th>Loan</th>
                            <th>Salary</th>
                            <th>EMI</th>
                            <th>Eligibility</th>
                            <th>Valuation</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Stage 1: Pending Level 1 -->
                        <tr>
                            <td>301</td>
                            <td>Amit Rane</td>
                            <td>Home Loan</td>
                            <td>₹ 18,00,000</td>
                            <td>₹ 60,000</td>
                            <td>₹ 16,800</td>
                            <td><span class="badge bg-success">Strong</span></td>
                            <td>-</td>
                            <td><span class="badge bg-warning text-dark">Pending Level 1</span></td>
                            <td>
                                <button class="btn btn-info btn-sm me-1" onclick="openEMIModal()">EMI</button>
                                <button class="btn btn-success btn-sm">Level 1 Approve</button>
                                <button class="btn btn-danger btn-sm">Reject</button>
                            </td>
                        </tr>

                        <!-- Stage 2: Level 1 Approved → Assign Agent -->
                        <tr>
                            <td>302</td>
                            <td>Rohini Kulkarni</td>
                            <td>Plot Loan</td>
                            <td>₹ 12,00,000</td>
                            <td>₹ 45,000</td>
                            <td>₹ 11,000</td>
                            <td><span class="badge bg-warning text-dark">Moderate</span></td>
                            <td>-</td>
                            <td><span class="badge bg-info text-dark">Level 1 Done</span></td>
                            <td>
                                <button class="btn btn-primary btn-sm">Assign Agent</button>
                            </td>
                        </tr>

                        <!-- Stage 3: Valuation Done → Level 3 Pending -->
                        <tr>
                            <td>303</td>
                            <td>Neha Patil</td>
                            <td>Home Loan</td>
                            <td>₹ 22,00,000</td>
                            <td>₹ 75,000</td>
                            <td>₹ 20,800</td>
                            <td><span class="badge bg-success">Strong</span></td>
                            <td>₹ 40,00,000</td>
                            <td><span class="badge bg-secondary">Valuation Done</span></td>
                            <td>
                                <button class="btn btn-success btn-sm me-1">Level 3 Approve</button>
                                <button class="btn btn-danger btn-sm">Reject</button>
                                <button class="btn btn-warning btn-sm" onclick="openValModal('303')">Valuation</button>
                            </td>
                        </tr>

                        <!-- Fully Approved -->
                        <tr>
                            <td>304</td>
                            <td>Swapnil Desai</td>
                            <td>Business Loan</td>
                            <td>₹ 35,00,000</td>
                            <td>₹ 1,20,000</td>
                            <td>₹ 33,000</td>
                            <td><span class="badge bg-success">Strong</span></td>
                            <td>₹ 70,00,000</td>
                            <td><span class="badge bg-success">Approved</span></td>
                            <td>
                                <button class="btn btn-primary btn-sm">View</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
function openEMIModal() {
    new bootstrap.Modal(document.getElementById('emiCalculatorModal')).show();
}
function calculateEMI() {
    let p = document.getElementById('loanAmt').value;
    let r = document.getElementById('roi').value / 1200;
    let n = document.getElementById('months').value;
    let emi = p * r * Math.pow(1+r, n) / (Math.pow(1+r,n)-1);
    document.getElementById('emiResult').innerHTML = "Monthly EMI: ₹ " + emi.toFixed(2);
    document.getElementById('emiResult').classList.remove('d-none');
}
function openValModal(id) {
    document.getElementById('valLoanId').innerText = id;
    new bootstrap.Modal(document.getElementById('valuationModal')).show();
}
</script>

</body>
</html>