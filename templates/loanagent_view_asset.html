<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Asset Evaluation - {{ app.application_number }}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {

            background: #f4f6f9;

            font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;

        }

        .sidebar {

            width: 230px;

            height: 100vh;

            background: #263238;

            position: fixed;

            padding: 25px;

        }

        .sidebar h4 {
            color: #ffffff;
        }

        .sidebar a {

            color: #b0bec5;

            display: block;

            margin: 12px 0;

            text-decoration: none;

            font-size: 14px;

        }

        .sidebar a:hover {
            color: #ffffff;
        }

        .content {

            margin-left: 250px;

            padding: 30px;

        }

        .page-title {

            font-size: 24px;

            font-weight: 600;

        }

        .card-header {

            background: #004d40;

            color: white;

            font-size: 16px;

            font-weight: 500;

        }

        .section-title {

            font-size: 16px;

            font-weight: 600;

            margin-bottom: 8px;

            color: #37474f;

        }

        .label-text {

            font-weight: 500;

            color: #455a64;

        }

        .asset-box {

            background: #ffffff;

            border-radius: 8px;

            padding: 12px;

            margin-bottom: 10px;

            border-left: 4px solid #00796b;

        }

        .asset-table td {

            padding: 4px 8px;

            font-size: 14px;

        }

        .badge-status {

            font-size: 12px;

            padding: 5px 10px;

            border-radius: 999px;

        }

        .form-card {

            border-top: 3px solid #00796b;

        }
    </style>
</head>

<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <h4>Loan Agent</h4>
        <a href="{{ url_for('loan_agent_dashboard') }}">Dashboard</a>
        <a href="{{ url_for('logout') }}">Logout</a>
    </div>

    <!-- Main Content -->
    <div class="content">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <div class="page-title">Asset Evaluation</div>
                <small class="text-muted">

                    Application No: <strong>{{ app.application_number }}</strong>
                </small>
            </div>

            <div>

                {% if app.asset_status == "pending" %}
                <span class="badge bg-warning text-dark badge-status">Pending</span>

                {% elif app.asset_status == "approved" %}
                <span class="badge bg-success badge-status">Approved</span>

                {% elif app.asset_status == "rejected" %}
                <span class="badge bg-danger badge-status">Rejected</span>

                {% endif %}
            </div>
        </div>

        <!-- Applicant & Loan Overview -->
        <div class="row g-3 mb-3">
            <div class="col-md-6">
                <div class="card shadow-sm">
                    <div class="card-header">Applicant Details</div>
                    <div class="card-body">
                        <p><span class="label-text">Applicant Name:</span> {{ app.full_name or '-' }}</p>
                        <p><span class="label-text">ID:</span> {{ app.id or '-' }}</p>
                        <p><span class="label-text">Email:</span> {{ app.email or app.applicant_email or '-' }}</p>
                        <p><span class="label-text">Mobile:</span> {{ app.mobile or app.applicant_mobile or '-' }}</p>
                        <p><span class="label-text">Created On:</span> {{ app.created_at or app.application_date or '-'
                            }}</p>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card shadow-sm">
                    <div class="card-header">Loan Summary</div>
                    <div class="card-body">
                        <p><span class="label-text">Loan Type:</span> {{ app.loan_type or '-' }}</p>
                        <p><span class="label-text">Loan Purpose:</span> {{ app.loan_purpose or '-' }}</p>
                        <p><span class="label-text">CIBIL Score:</span> {{ app.cibil_score or '-' }}</p>
                        <p><span class="label-text">Requested Amount:</span> {{ app.loan_amount or app.requested_amount
                            or '-' }}</p>
                        <p><span class="label-text">Interest Type:</span> {{ app.interest_type or '-' }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Loan Info (JSON) -->
        <div class="card shadow-sm mb-3">
            <div class="card-header">Loan Details (Form Inputs)</div>
            <div class="card-body">

                {% if app.loaninfo %}
                <div class="row">

                    {% for key, value in app.loaninfo.items() %}
                    <div class="col-md-4 mb-2">
                        <span class="label-text">{{ key.replace('_', ' ') | title }}:</span>
                        <div>{{ value }}</div>
                    </div>

                    {% endfor %}
                </div>

                {% else %}
                <p class="text-muted mb-0">No extra loan-specific data available.</p>

                {% endif %}
            </div>
        </div>

        <!-- Asset Details -->
        <div class="card shadow-sm mb-3">
            <div class="card-header">Asset Details</div>
            <div class="card-body">

                {% if app.assetinfo %}

                {% for asset in app.assetinfo %}
                <div class="asset-box">
                    <table class="asset-table">

                        {% for key, value in asset.items() %}
                        <tr>
                            <td class="label-text">{{ key.replace('_', ' ') | title }}:</td>
                            <td>{{ value }}</td>
                        </tr>

                        {% endfor %}
                    </table>
                </div>

                {% endfor %}

                {% else %}
                <p class="text-muted mb-0">No asset data captured for this application.</p>

                {% endif %}
            </div>
        </div>

        <!-- Evaluation Form -->
        <div class="card shadow-sm form-card mb-4">
            <div class="card-header">Asset Evaluation (Agent Action)</div>
            <div class="card-body">
                <form method="post">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Evaluated Asset Value (₹)</label>
                            <input type="number" step="0.01" class="form-control" name="evaluated_value"
                                value="{{ app.asset_evaluated_value or '' }}" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Decision</label>
                            <div class="mt-2">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="decision" id="decisionApprove"
                                        value="approved" {% if app.asset_status=='approved' %}checked{% endif %}
                                        required>
                                    <label class="form-check-label" for="decisionApprove">Approve</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="decision" id="decisionReject"
                                        value="rejected" {% if app.asset_status=='rejected' %}checked{% endif %}>
                                    <label class="form-check-label" for="decisionReject">Reject</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Remarks / Observation</label>
                        <textarea class="form-control" name="remarks" rows="3"
                            placeholder="Write your observations: legal checks, market value justification, encumbrances, etc.">{{ app.asset_evaluator_remark or '' }}</textarea>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('loan_agent_dashboard') }}" class="btn btn-outline-secondary">

                            ← Back to Dashboard
                        </a>
                        <button type="submit" class="btn btn-success">

                            Submit Evaluation
                        </button>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>