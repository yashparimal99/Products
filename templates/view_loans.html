<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Loans â€” DigiBank</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"/>

    <style>
        :root {
            --brand: #0B4D83;
            --brand-alt: #97144D;
            --bg-page: #f1f5f9;
            --border-soft: #e2e8f0;
            --text-main: #0f172a;
            --text-muted: #64748b;
        }

        body {
            background: radial-gradient(circle at top left, #e3f2fd 0, #f1f5f9 40%, #ffffff 100%);
            font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text-main);
        }

        .page-shell {
            max-width: 1150px;
            margin: 24px auto 40px;
        }

        .top-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .top-row-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-muted);
        }

        .top-header {
            background: linear-gradient(90deg, #0B4D83, #186cc4);
            border-radius: 16px;
            padding: 18px 22px;
            color: #f9fafb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 12px 30px rgba(15, 23, 42, 0.18);
            margin-bottom: 18px;
        }

        .top-header-main {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .top-title {
            font-size: 20px;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .top-title i {
            font-size: 22px;
        }

        .top-subtitle {
            font-size: 13px;
            font-weight: 500;
            opacity: 0.95;
        }

        .badge-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.4);
            background-color: rgba(15,23,42,0.15);
            color: #e2f3ff;
        }

        .badge-chip i {
            font-size: 14px;
        }

        .card-block {
            background-color: #ffffff;
            border-radius: 14px;
            border: 1px solid var(--border-soft);
            padding: 16px 20px 20px;
            box-shadow: 0 2px 10px rgba(15, 23, 42, 0.06);
        }

        .card-header-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .card-title-text {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-main);
        }

        .card-subtext {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 500;
        }

        table.dataTable thead th {
            background-color: #0B4D83;
            color: #ffffff !important;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        table.dataTable tbody td {
            vertical-align: middle;
            font-size: 13px;
        }

        .amount-cell {
            text-align: right;
            font-weight: 600;
        }

        .status-badge {
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-draft {
            background-color: #e5e7eb;
            color: #374151;
        }

        .status-submitted {
            background-color: #e0f2fe;
            color: #075985;
        }

        .status-under-review,
        .status-agent-approved,
        .status-pending-manager,
        .status-manager-approved {
            background-color: #fef9c3;
            color: #92400e;
        }

        .status-approved,
        .status-disbursed-active {
            background-color: #dcfce7;
            color: #166534;
        }

        .status-disbursed-closed {
            background-color: #e5e7eb;
            color: #374151;
        }

        .status-disbursed-defaulted {
            background-color: #fee2e2;
            color: #b91c1c;
        }

        .status-rejected {
            background-color: #fee2e2;
            color: #b91c1c;
        }

        .badge-pill-soft {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 999px;
            background-color: #eff6ff;
            color: #1d4ed8;
            font-size: 11px;
        }

        .text-small-muted {
            font-size: 11px;
            color: var(--text-muted);
        }

        .btn-schedule {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 999px;
            font-weight: 600;
        }
    </style>
    
  <style>
    body {
      background-color: #f8f9fa;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px 0 0 0;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
 
    /* Sidebar Offcanvas */
    #sidebarMenu.offcanvas-start {
      width: 250px;
    }
 
    #sidebarMenu .offcanvas-body {
      padding: 0.5rem 1rem;
    }
 
    #sidebarMenu .nav-link {
      font-size: 0.9rem;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #333;
      transition: color 0.3s;
    }
 
    #sidebarMenu .nav-link i {
      font-size: 1.1rem;
    }
 
    #sidebarMenu .nav-link.active {
      font-weight: 700;
      color: #0B4D83 !important;
      background-color: #f0d7e0;
      border-radius: 4px;
    }
 
    #sidebarMenu .nav-link:hover {
      color: #7a0f3e;
      background-color: #f9e5ef;
      border-radius: 4px;
    }
 
    .top-bar button.btn-outline-light {
      border: 1.5px solid white;
      color: white;
      background: transparent;
      padding: 4px 10px;
      font-size: 1.3rem;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s, color 0.2s;
    }
 
    .top-bar button.btn-outline-light:hover {
      background-color: white;
      color: #0B4D83;
    }
 
 
    /* Top Bar */
    .top-bar {
      background-color: #0B4D83;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      user-select: none;
      position: sticky;
      top: 0;
      z-index: 1030;
    }
 
    .top-bar h5 {
      margin: 0;
      font-weight: 700;
      flex-grow: 1;
      text-align: center;
      color: white;
    }
 
    .logout-btn {
      background: transparent;
      border: 1.5px solid white;
      color: white;
      padding: 5px 15px;
      border-radius: 4px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s, color 0.2s;
      flex-shrink: 0;
    }
 
    .logout-btn:hover {
      background-color: white;
      color: #0B4D83;
    }
 
    /* Search Bar Row with Sidebar Toggle & Chatbot */
    .search-chatbar {
      max-width: 900px;
      margin: 15px auto 40px auto;
      padding: 0 15px;
      display: flex;
      align-items: center;
      gap: 15px;
    }
 
    /* Sidebar toggle button */
    .search-chatbar .btn-toggle-sidebar {
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 5px;
      border: 1.5px solid #ccc;
      color: #444;
      background: white;
      transition: border-color 0.3s, color 0.3s;
      cursor: pointer;
      flex-shrink: 0;
      min-width: 42px;
      padding: 6px 8px;
      font-size: 1.3rem;
    }
 
    .search-chatbar .btn-toggle-sidebar:hover {
      border-color: #0B4D83;
      color: #0B4D83;
    }
 
    /* Search input centered and wide */
    .search-chatbar input[type="text"] {
      flex-grow: 1;
      padding: 10px 14px;
      border-radius: 5px;
      border: 1.5px solid #ccc;
      font-size: 1rem;
      outline-offset: 0;
      transition: border-color 0.3s;
      width: 9000px;
      margin: 0 auto;
      display: block;
    }
 
    .search-chatbar input[type="text"]:focus {
      border-color: #0B4D83;
      box-shadow: 0 0 5px rgba(151, 20, 77, 0.5);
    }
 
    /* Chatbot button right aligned */
    .search-chatbar .chatbot-btn {
      background-color: #0B4D83;
      border: none;
      color: white;
      padding: 10px 14px;
      border-radius: 5px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s ease;
      font-size: 1.3rem;
      flex-shrink: 0;
    }
 
    .search-chatbar .chatbot-btn:hover {
      background-color: #7a0f3e;
    }
 
    /* Dashboard Cards */
    .dashboard-card {
      transition: 0.3s;
      height: 280px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 20px 20px 30px 20px;
      text-align: center;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
    }
 
    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.15);
    }
 
    .dashboard-icon {
      font-size: 32px;
      color: #0B4D83;
      margin-bottom: 15px;
    }
 
    .dashboard-card h5 {
      font-weight: 600;
      margin-bottom: 10px;
    }
 
    .dashboard-card p {
      flex-grow: 1;
      font-size: 14px;
      color: #555;
      margin-bottom: 15px;
    }
 
    .btn-digibank {
      background-color: #0B4D83;
      color: #fff;
      border: none;
      padding: 8px 18px;
      font-size: 0.9rem;
      border-radius: 25px;
      transition: background-color 0.3s ease;
    }
 
    .btn-digibank:hover {
      background-color: #7a0f3e;
      color: white;
    }
 
    /* Footer */
    footer.bg-custom {
      background-color: #0B4D83;
    }
  </style>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800&display=swap');
 
.digi-bank-logo {
  display: flex;
  align-items: center;
  gap: 12px;
  text-decoration: none;
  transition: transform 0.3s ease;
}
.digi-bank-logo:hover {
  transform: scale(1.05);
}
.logo-icon {
  width: 50px;
  height: 50px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 100%);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  box-shadow: 0 6px 18px rgba(102, 126, 234, 0.3), 0 2px 6px rgba(0, 0, 0, 0.1);
}
.logo-icon::before {
  content: '';
  position: absolute;
  top: 8px;
  left: 8px;
  right: 8px;
  bottom: 8px;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 8px;
}
.logo-icon::after {
  content: 'D';
  position: absolute;
  color: transparent;
  background: linear-gradient(135deg, #667eea, #764ba2);
  background-clip: text;
  -webkit-background-clip: text;
  font-weight: 800;
  font-size: 20px;
  z-index: 2;
}
.logo-text {
  color: #fff;
}
.main-text {
  font-size: 20px;
  font-weight: 800;
  letter-spacing: -0.5px;
  line-height: 1;
}
.digi {
  background: linear-gradient(135deg, #87CEEB 0%, #98D8E8 25%, #FFF8DC 50%, #87CEFA 100%);
  background-clip: text;
  -webkit-background-clip: text;
  color: transparent;
  text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
}
.bank {
  color: #ffffff;
  margin-left: 3px;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}
.tagline {
  font-size: 9px;
  font-weight: 600;
  color: #e8f4f8;
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-top: 2px;
}

  </style>
</head>
<body>


  <!-- Sidebar Offcanvas -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="sidebarMenuLabel">Welcome, {{ user.name }} ! </h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="nav flex-column">
        <li class="nav-item mb-2">
          <a class="nav-link text-dark active" href="{{ url_for('home') }}">
            <i class="bi bi-speedometer2 me-2"></i> Home
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('viewaccounts') }}">
            <i class="bi bi-person-lines-fill me-2"></i> View Accounts
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('userdashloan') }}">
            <i class="bi bi-cash-coin me-2"></i> Loans
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('Txnhistory') }}">
            <i class="bi bi-clock-history me-2"></i> Transaction History
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('accountbal') }}">
            <i class="bi bi-wallet2 me-2"></i> Check Balance
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('profile') }}">
            <i class="bi bi-gift-fill me-2"></i> Profile
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('paybill') }}">
            <i class="bi bi-credit-card me-2"></i> Pay Bill
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="#">
            <i class="bi bi-person-rolodex me-2"></i> Get Contact
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="#">
            <i class="bi bi-shield-lock-fill me-2"></i> Privacy & Security
          </a>
        </li>
 
      </ul>
    </div>
  </div>
 
  <!-- ---------------------------- -->
  <div class="top-bar d-flex align-items-center">
    <!-- left toggle -->
    <button class="btn btn-outline-light btn-sm me-3" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu"
      aria-controls="sidebarMenu" aria-label="Toggle sidebar">
      <i class="bi bi-list"></i>
    </button>
 
    <!-- ðŸ”½ Custom DigiBank Logo -->
    <a class="navbar-brand digi-bank-logo" href="{{ url_for('home') }}">
      <div class="logo-icon"></div>
      <div class="logo-text">
        <div class="main-text">
          <span class="digi">DiGi</span><span class="bank">Bank</span>
        </div>
        <div class="tagline">Smart Banking</div>
      </div>
    </a>
 
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #0B4D83 !important; width: 100%;">
      <div class="container-fluid">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <!-- <li class="nav-item"><a class="nav-link active" href="{{ url_for('home') }}">Home</a></li> -->
            <li class="nav-item"><a class="nav-link" href="{{ url_for('dashboard') }}">My Activities</a>
            </li>
            <!-- Open Account Dropdown -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="accountDropdown" role="button" data-bs-toggle="dropdown"
                aria-expanded="false">Open Account</a>
              <ul class="dropdown-menu" aria-labelledby="accountDropdown">
                <li><a class="dropdown-item" href="{{ url_for('open_account') }}">Savings
                    Account</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_account') }}">Salary Account</a>
                </li>
                <li><a class="dropdown-item" href="{{ url_for('open_account') }}">Current
                    Account</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_account') }}">Safe Custody
                    Account</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_account') }}">Pension
                    Account</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_account') }}">PMJDY Account</a>
                </li>
              </ul>
            </li>
            <!-- Deposits Dropdown -->
            <li class="nav-item dropdown">
              <button class="nav-link dropdown-toggle" href="#" id="depositsDropdown" role="button"
                data-bs-toggle="dropdown" aria-expanded="false">Deposits</button>
              <ul class="dropdown-menu" aria-labelledby="depositsDropdown">
                <li><a class="dropdown-item" href="{{ url_for('open_deposits') }}">Digital Fixed
                    Deposits</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_deposits') }}">Fixed
                    Deposits</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_deposits') }}">Recurring
                    Deposits</a></li>
              </ul>
            </li>
            <!-- Deposits Dropdown -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="loanDropdown" role="button" data-bs-toggle="dropdown"
                aria-expanded="false">Loans</a>
              <ul class="dropdown-menu" aria-labelledby="loanDropdown">
                <li><a class="dropdown-item" href="{{ url_for('userdashloan') }}">Home Loan</a></li>
                <li><a class="dropdown-item" href="{{ url_for('userdashloan') }}">Personal Loan</a></li>
                <li><a class="dropdown-item" href="{{ url_for('userdashloan') }}">Busniness Loan</a></li>
 
 
              </ul>
            </li>
            <!-- Deposits Dropdown -->
            <li class="nav-item dropdown">
              <button class="nav-link dropdown-toggle" id="cardDropdown" role="button" data-bs-toggle="dropdown"
                aria-expanded="false" type="button">Cards</button>
              <ul class="dropdown-menu" aria-labelledby="cardDropdown">
                <li><a class="dropdown-item" href="{{ url_for('open_cards') }}">Credit Cards</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_cards') }}">Debit Cards</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_cards') }}">Prepaid Cards</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_cards') }}">Forex Cards</a></li>
              </ul>
            </li>
            
            <!-- Deposits Dropdown -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="investDropdown" role="button" data-bs-toggle="dropdown"
                aria-expanded="false">Investments</a>
              <ul class="dropdown-menu" aria-labelledby="investDropdown">
                <li><a class="dropdown-item" href="{{ url_for('userdashinvest') }}">Public Provident Fund</a></li>
                <li><a class="dropdown-item" href="{{ url_for('userdashinvest') }}">Floating Rate Saving Bonds</a></li>
                <li><a class="dropdown-item" href="{{ url_for('userdashinvest') }}">National Pension System</a></li>
              </ul>
            </li>
          </ul>
          <div class="d-flex align-items-center">
            <h5 class="m-0 me-2 fs-6">Welcome, {{ user.name }} ! </h5>
            <a href="{{ url_for('logout') }}" class="logout-btn btn btn-outline-light btn-sm">
              Logout
            </a>
          </div>
 
        </div>
      </div>
    </nav>
    <!-- End of custom navbar -->
 
  </div>
 
 
 
  </div>

<div class="page-shell">

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-3">
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
              <strong>{{ message }}</strong>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Top small row -->
    <div class="top-row">
        <div class="top-row-title">
            DigiBank â€¢ My Loans
        </div>
        <!-- <div>
            <a href="{{ url_for('dashboard') }}" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-speedometer2"></i> Back to Dashboard
            </a>
            <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline-secondary">
                <i class="bi bi-box-arrow-right"></i> Logout
            </a>
        </div> -->
    </div>

    <!-- Gradient header -->
    <div class="top-header">
        <div class="top-header-main">
            <h1 class="top-title">
                <i class="bi bi-cash-coin"></i>
                Hello, {{ user.name or 'Customer' }}
            </h1>
            <div class="top-subtitle">
                Here is a consolidated view of all your loan applications and active loan accounts.
            </div>
        </div>
        <div class="d-flex flex-column gap-2 align-items-end">
            <span class="badge-chip">
                <i class="bi bi-file-earmark-text"></i>
                Total Applications: {{ loans|length }}
            </span>
        </div>
    </div>

    <!-- Loans table -->
    <div class="card-block">
        <div class="card-header-line">
            <div>
                <div class="card-title-text">My Loans & Applications</div>
                <div class="card-subtext">
                    Track status, EMI and loan account details in one place. Click on <strong>View EMI Schedule</strong> for active loans.
                </div>
            </div>
        </div>

        {% if loans|length == 0 %}
            <div class="alert alert-info mb-0">
                You do not have any loan applications yet.
                <a href="{{ url_for('apply_loan') }}" class="alert-link">Click here to apply for a new loan.</a>
            </div>
        {% else %}
            <div class="table-responsive">
                <table id="loansTable" class="table table-striped table-bordered align-middle w-100">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Loan / Account</th>
                            <th>Type & Purpose</th>
                            <th>Amount (â‚¹)</th>
                            <th>EMI (â‚¹)</th>
                            <th>Tenure</th>
                            <th>Status</th>
                            <th>Dates</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for loan in loans %}
                        {% set s = (loan.status or '') %}
                        <tr>
                            <td>{{ loop.index }}</td>

                            <!-- Loan / Account -->
                            <td>
                                <div class="fw-semibold">
                                    {% if loan.loan_account_no %}
                                        A/c: {{ loan.loan_account_no }}
                                    {% else %}
                                        App: {{ loan.application_number }}
                                    {% endif %}
                                </div>
                                <div class="text-small-muted">
                                    Application No: {{ loan.application_number }}
                                </div>
                                {% if loan.outstanding_principal %}
                                    <div class="text-small-muted">
                                        Outstanding: â‚¹{{ "{:,.0f}".format(loan.outstanding_principal|float) }}
                                    </div>
                                {% endif %}
                            </td>

                            <!-- Type & Purpose -->
                            <td>
                                <div class="fw-semibold">
                                    {{ loan.loan_type_label }}
                                </div>
                                <div class="text-small-muted">
                                    {{ loan.purpose or '-' }}
                                </div>
                                {% if loan.loan_account_no %}
                                    <span class="badge-pill-soft mt-1">
                                        <i class="bi bi-shield-check"></i> Disbursed
                                    </span>
                                {% endif %}
                            </td>

                            <!-- Amount -->
                            <td class="amount-cell">
                                {% if loan.loan_amount is not none %}
                                    â‚¹{{ "{:,.0f}".format(loan.loan_amount|float) }}
                                {% else %}
                                    -
                                {% endif %}
                                <div class="text-small-muted">
                                    {% if loan.sanctioned_amount %}
                                        Sanctioned: â‚¹{{ "{:,.0f}".format(loan.sanctioned_amount|float) }}
                                    {% endif %}
                                </div>
                            </td>

                            <!-- EMI -->
                            <td class="amount-cell">
                                {% if loan.emi_amount %}
                                    â‚¹{{ "{:,.0f}".format(loan.emi_amount|float) }}
                                {% else %}
                                    -
                                {% endif %}
                                <div class="text-small-muted">
                                    {% if loan.interest_rate %}
                                        Rate: {{ "%.2f"|format(loan.interest_rate|float) }}%
                                    {% else %}
                                        Rate: -
                                    {% endif %}
                                </div>
                            </td>

                            <!-- Tenure -->
                            <td>
                                {% if loan.loan_tenure_years %}
                                    {{ "%.1f"|format(loan.loan_tenure_years|float) }} yrs
                                {% else %}
                                    -
                                {% endif %}
                                <div class="text-small-muted">
                                    {% if loan.tenure_months %}
                                        ({{ loan.tenure_months }} months)
                                    {% endif %}
                                </div>
                            </td>

                            <!-- Status -->
                            <td>
                                {% set status_class = '' %}
                                {% if s.startswith('disbursed_') %}
                                    {% if 'active' in s %}
                                        {% set status_class = 'status-disbursed-active' %}
                                    {% elif 'closed' in s %}
                                        {% set status_class = 'status-disbursed-closed' %}
                                    {% elif 'defaulted' in s %}
                                        {% set status_class = 'status-disbursed-defaulted' %}
                                    {% endif %}
                                {% elif s == 'draft' %}
                                    {% set status_class = 'status-draft' %}
                                {% elif s == 'submitted' %}
                                    {% set status_class = 'status-submitted' %}
                                {% elif s in ['under_review','agent_approved','pending_manager','manager_approved'] %}
                                    {% set status_class = 'status-under-review' %}
                                {% elif s == 'approved' %}
                                    {% set status_class = 'status-approved' %}
                                {% elif s == 'rejected' %}
                                    {% set status_class = 'status-rejected' %}
                                {% else %}
                                    {% set status_class = 'status-draft' %}
                                {% endif %}

                                <span class="status-badge {{ status_class }}">
                                    {{ loan.status_label }}
                                </span>

                                {% if loan.manager_final_decision %}
                                    <div class="text-small-muted mt-1">
                                        Manager decision: {{ loan.manager_final_decision|title }}
                                    </div>
                                {% endif %}
                            </td>

                            <!-- Dates -->
                            <td>
                                <div class="text-small-muted">
                                    Applied: {{ loan.application_date or '-' }}
                                </div>
                                {% if loan.start_date %}
                                    <div class="text-small-muted">
                                        Start: {{ loan.start_date }}
                                    </div>
                                {% endif %}
                                {% if loan.next_emi_date %}
                                    <div class="text-small-muted">
                                        Next EMI: {{ loan.next_emi_date }}
                                    </div>
                                {% endif %}
                            </td>

                            <!-- Action -->
                            <td>
                                {% if loan.loan_account_id %}
                                    <a href="{{ url_for('loan_emi_schedule', loan_account_id=loan.loan_account_id) }}"
                                       class="btn btn-outline-primary btn-schedule">
                                        <i class="bi bi-calendar-week"></i> View EMI Schedule
                                    </a>
                                {% else %}
                                    <span class="text-small-muted">Not disbursed yet</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    </div>

</div>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<script>
    $(document).ready(function () {
        $('#loansTable').DataTable({
            pageLength: 10,
            order: [[0, 'asc']]
        });
    });
</script>

</body>
</html>
