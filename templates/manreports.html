<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reports & Analytics - DigiBank</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    body {
      background-color: #f8f9fa;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px 0 0 0;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    #sidebarMenu.offcanvas-start { width: 250px; }
    #sidebarMenu .offcanvas-body { padding: 0.5rem 1rem; }
    #sidebarMenu .nav-link {
      font-size: 0.9rem;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #333;
      transition: color 0.3s;
    }
    #sidebarMenu .nav-link i { font-size: 1.1rem; }
    #sidebarMenu .nav-link.active {
      font-weight: 700;
      color: #97144D !important;
      background-color: #f0d7e0;
      border-radius: 4px;
    }
    #sidebarMenu .nav-link:hover {
      color: #7a0f3e;
      background-color: #f9e5ef;
      border-radius: 4px;
    }

    .top-bar button.btn-outline-light {
      border: 1.5px solid white;
      color: white;
      background: transparent;
      padding: 4px 10px;
      font-size: 1.3rem;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s, color 0.2s;
    }
    .top-bar button.btn-outline-light:hover {
      background-color: white;
      color: #97144D;
    }

    .top-bar {
      background-color: #97144D;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      user-select: none;
      position: sticky;
      top: 0;
      z-index: 1030;
    }
    .top-bar h5 {
      margin: 0;
      font-weight: 700;
      flex-grow: 1;
      text-align: center;
      color: white;
    }
    .logout-btn {
      background: transparent;
      border: 1.5px solid white;
      color: white;
      padding: 5px 15px;
      border-radius: 4px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s, color 0.2s;
      flex-shrink: 0;
    }
    .logout-btn:hover {
      background-color: white;
      color: #97144D;
    }

    .search-chatbar {
      max-width: 900px;
      margin: 15px auto 40px auto;
      padding: 0 15px;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .search-chatbar input[type="text"] {
      flex-grow: 1;
      padding: 10px 14px;
      border-radius: 5px;
      border: 1.5px solid #ccc;
      font-size: 1rem;
      outline-offset: 0;
      transition: border-color 0.3s;
      width: 9000px; 
      margin: 0 auto;
      display: block;
    }
    .search-chatbar input[type="text"]:focus {
      border-color: #97144D;
      box-shadow: 0 0 5px rgba(151, 20, 77, 0.5);
    }
    .search-chatbar .chatbot-btn {
      background-color: #97144D;
      border: none;
      color: white;
      padding: 10px 14px;
      border-radius: 5px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s ease;
      font-size: 1.3rem;
      flex-shrink: 0;
    }
    .search-chatbar .chatbot-btn:hover {
      background-color: #7a0f3e;
    }

    /* Reports Specific Styles */
    .report-card {
      transition: 0.3s;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
      margin-bottom: 20px;
    }
    .report-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.15);
    }
    .report-card-header {
      background-color: #97144D;
      color: white;
      border-radius: 8px 8px 0 0 !important;
      padding: 15px 20px;
    }
    .chart-container {
      height: 250px;
      position: relative;
    }
    .kpi-card {
      border-radius: 8px;
      padding: 15px;
      background-color: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 15px;
    }
    .kpi-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: #97144D;
    }
    .report-badge {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    footer.bg-custom {
      background-color: #97144D;
      color: white;
      text-align: center;
      padding: 15px 0;
      margin-top: auto;
    }
    
    /* Time period selector */
    .btn-period {
      border: 1px solid #dee2e6;
    }
    .btn-period.active {
      background-color: #97144D;
      color: white;
      border-color: #97144D;
    }
   .btn-primary {
      border: 1px solid #dee2e6;
    }
    .btn-primary {
      background-color: #97144D;
      
    } 
    .btn-outline-primary {
      border: 1px solid #dee2e6;
    }
    .btn-outline-primary {
      background-color: #97144D;
      color: white;
      border-color: #97144D;
    }
    .btn-outline-primary active {
      background-color: #97144D;
      color: white;
      border-color: #97144D;
    }
    /* Toast notification */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <!-- Toast notification container -->
  <div class="toast-container"></div>

  <!-- Sidebar Offcanvas -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="sidebarMenuLabel">Manager</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="nav flex-column">
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('dashboard') }}">
            <i class="bi bi-speedometer2 me-2"></i> Dashboard
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('manage_accounts') }}">
            <i class="bi bi-people-fill me-2"></i> Manage Accounts
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('managerapprovals') }}">
            <i class="bi bi-file-earmark-check me-2"></i> Manage Approvals
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('transactions_review') }}">
            <i class="bi bi-list-check me-2"></i> Transaction Review
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark active" href="{{ url_for('manreport') }}">
            <i class="bi bi-graph-up me-2"></i> Reports & Analytics
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('manstaff') }}">
            <i class="bi bi-person-badge me-2"></i> Staff Management
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('branchperformance') }}">
            <i class="bi bi-building me-2"></i> Branch Performance
          </a>
        </li>
      </ul>
    </div>
  </div>

  <!-- Top Bar -->
  <div class="top-bar d-flex align-items-center">
  <button class="btn btn-outline-light btn-sm me-3"
          data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu"
          aria-controls="sidebarMenu" aria-label="Toggle sidebar">
    <i class="bi bi-list"></i>
  </button>

  <h5 class="me-auto mb-0">DigiBank Manager Dashboard</h5>

  <div class="d-flex align-items-center">
    <p class="navbar-text text-white mb-0">
      Welcome, <strong>{{ user.name }}</strong>
    </p>
  </div>

  <!-- Ensuring contrast with .text-white -->
  <a href="{{ url_for('logout') }}" class="logout-btn ms-3">
    Logout
  </a>
</div>

  <!-- Search Bar and Chatbot with Sidebar Toggle -->
  <div class="search-chatbar">
    <input type="text" placeholder="Search reports..." aria-label="Search" id="reportSearchInput" />
    <button class="chatbot-btn" aria-label="Chatbot">
      <i class="bi bi-chat-dots-fill"></i>
    </button>
  </div>

  <!-- Main Content -->
  <div class="container my-4 flex-grow-1">
    <!-- Time Period Selector -->
    <div class="card report-card mb-4">
      <div class="card-body">
        <div class="row align-items-center">
          <div class="col-md-3">
            <h6 class="mb-0">Report Period</h6>
          </div>
          <div class="col-md-6">
            <div class="btn-group w-100" id="periodSelector">
              <button class="btn btn-period active" data-period="today">Today</button>
              <button class="btn btn-period" data-period="week">Week</button>
              <button class="btn btn-period" data-period="month">Month</button>
              <button class="btn btn-period" data-period="quarter">Quarter</button>
              <button class="btn btn-period" data-period="year">Year</button>
            </div>
          </div>
          <div class="col-md-3">
            <button class="btn btn-primary w-100" id="exportReportBtn">
              <i class="bi bi-download me-1"></i> Export
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Key Metrics -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="kpi-card">
          <h6 class="text-muted">New Accounts</h6>
          <div class="kpi-value">142</div>
          <div class="text-success">+12% from last month</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="kpi-card">
          <h6 class="text-muted">Total Deposits</h6>
          <div class="kpi-value">₹8.2M</div>
          <div class="text-success">+5.4% from last month</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="kpi-card">
          <h6 class="text-muted">Loan Disbursed</h6>
          <div class="kpi-value">₹3.5M</div>
          <div class="text-danger">-2.1% from last month</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="kpi-card">
          <h6 class="text-muted">Transactions</h6>
          <div class="kpi-value">1,245</div>
          <div class="text-success">+8.7% from last month</div>
        </div>
      </div>
    </div>

    <!-- Main Charts -->
    <div class="row mb-4">
      <div class="col-md-8">
        <div class="card report-card h-100">
          <div class="report-card-header">
            <h5 class="mb-0"><i class="bi bi-bar-chart me-2"></i> Branch Performance</h5>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="branchPerformanceChart"></canvas>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card report-card h-100">
          <div class="report-card-header">
            <h5 class="mb-0"><i class="bi bi-pie-chart me-2"></i> Account Distribution</h5>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="accountDistributionChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Secondary Charts -->
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="card report-card h-100">
          <div class="report-card-header">
            <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i> Transaction Volume</h5>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="transactionVolumeChart"></canvas>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card report-card h-100">
          <div class="report-card-header">
            <h5 class="mb-0"><i class="bi bi-people me-2"></i> Customer Demographics</h5>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="customerDemographicsChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Charts -->
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="card report-card h-100">
          <div class="report-card-header">
            <h5 class="mb-0"><i class="bi bi-cash-coin me-2"></i> Revenue Sources</h5>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="revenueSourcesChart"></canvas>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card report-card h-100">
          <div class="report-card-header">
            <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i> Customer Activity Timeline</h5>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="customerActivityChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Report Generator -->
    <div class="card report-card mb-4">
      <div class="report-card-header">
        <h5 class="mb-0"><i class="bi bi-file-earmark-text me-2"></i> Custom Report Generator</h5>
      </div>
      <div class="card-body">
        <form id="reportGeneratorForm">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Report Type</label>
              <select class="form-select" id="reportType">
                <option>Financial Summary</option>
                <option>Customer Activity</option>
                <option>Transaction Analysis</option>
                <option>Risk Assessment</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Date Range</label>
              <div class="input-group">
                <input type="date" class="form-control" id="startDate">
                <span class="input-group-text">to</span>
                <input type="date" class="form-control" id="endDate">
              </div>
            </div>
            <div class="col-md-4">
              <label class="form-label">Group By</label>
              <select class="form-select" id="groupBy">
                <option>Daily</option>
                <option>Weekly</option>
                <option>Monthly</option>
                <option>Quarterly</option>
              </select>
            </div>
          </div>
          <div class="row g-3 mt-2">
            <div class="col-md-6">
              <label class="form-label">Filters</label>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="includeSavings" checked>
                <label class="form-check-label" for="includeSavings">Include Savings Accounts</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="includeCurrent" checked>
                <label class="form-check-label" for="includeCurrent">Include Current Accounts</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="includeLoans" checked>
                <label class="form-check-label" for="includeLoans">Include Loan Accounts</label>
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Output Format</label>
              <div class="btn-group w-100" id="formatSelector">
                <button type="button" class="btn btn-outline-primary" data-format="pdf">PDF</button>
                <button type="button" class="btn btn-outline-primary active" data-format="excel">Excel</button>
                <button type="button" class="btn btn-outline-primary" data-format="csv">CSV</button>
              </div>
            </div>
          </div>
          <div class="d-grid gap-2 mt-3">
            <button type="button" class="btn btn-primary" id="generateReportBtn">Generate Report</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Saved Reports -->
    <div class="card report-card">
      <div class="report-card-header">
        <h5 class="mb-0"><i class="bi bi-collection me-2"></i> Saved Reports</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover" id="savedReportsTable">
            <thead>
              <tr>
                <th>Report Name</th>
                <th>Type</th>
                <th>Last Generated</th>
                <th>Schedule</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr data-report-id="1">
                <td>Monthly Financial Summary</td>
                <td>Financial</td>
                <td>May 1, 2023</td>
                <td>Monthly (1st)</td>
                <td>
                  <button class="btn btn-sm btn-outline-primary me-1 run-report-btn">Run</button>
                  <button class="btn btn-sm btn-outline-secondary me-1 edit-report-btn">Edit</button>
                  <button class="btn btn-sm btn-outline-danger delete-report-btn">Delete</button>
                </td>
              </tr>
              <tr data-report-id="2">
                <td>Weekly Transaction Report</td>
                <td>Transaction</td>
                <td>Today, 9:00 AM</td>
                <td>Weekly (Monday)</td>
                <td>
                  <button class="btn btn-sm btn-outline-primary me-1 run-report-btn">Run</button>
                  <button class="btn btn-sm btn-outline-secondary me-1 edit-report-btn">Edit</button>
                  <button class="btn btn-sm btn-outline-danger delete-report-btn">Delete</button>
                </td>
              </tr>
              <tr data-report-id="3">
                <td>Customer Acquisition Q2</td>
                <td>Customer</td>
                <td>Apr 1, 2023</td>
                <td>Quarterly</td>
                <td>
                  <button class="btn btn-sm btn-outline-primary me-1 run-report-btn">Run</button>
                  <button class="btn btn-sm btn-outline-secondary me-1 edit-report-btn">Edit</button>
                  <button class="btn btn-sm btn-outline-danger delete-report-btn">Delete</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-custom text-white text-center py-3 mt-auto">
    © 2025 DigiBank. Manager Dashboard. All rights reserved.
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Chart instances
    let charts = {};
    
    // Sample data for reports
    const sampleReportData = {
      'Monthly Financial Summary': [
        ['Month', 'Revenue', 'Expenses', 'Profit'],
        ['January', 150000, 120000, 30000],
        ['February', 160000, 125000, 35000],
        ['March', 170000, 130000, 40000],
        ['April', 180000, 135000, 45000],
        ['May', 190000, 140000, 50000]
      ],
      'Weekly Transaction Report': [
        ['Week', 'Transactions', 'Amount', 'Avg. Transaction'],
        ['Week 1', 1245, 8200000, 6586],
        ['Week 2', 1320, 8700000, 6591],
        ['Week 3', 1280, 8400000, 6563],
        ['Week 4', 1400, 9200000, 6571]
      ],
      'Customer Acquisition Q2': [
        ['Channel', 'New Customers', 'Cost per Acquisition', 'Conversion Rate'],
        ['Online', 450, 1200, '3.2%'],
        ['Branch', 320, 1800, '4.8%'],
        ['Referral', 180, 800, '5.6%'],
        ['Partnership', 210, 1500, '2.9%']
      ]
    };
    
    // Initialize charts
    document.addEventListener('DOMContentLoaded', function() {
      // Set default dates for report generator
      const today = new Date();
      const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
      
      document.getElementById('startDate').valueAsDate = firstDayOfMonth;
      document.getElementById('endDate').valueAsDate = today;
      
      // Initialize all charts
      initCharts();
      
      // Add event listeners
      document.querySelectorAll('#periodSelector .btn-period').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('#periodSelector .btn-period').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          updateCharts(this.dataset.period);
        });
      });
      
      document.getElementById('generateReportBtn').addEventListener('click', function() {
        generateReport();
      });
      
      document.getElementById('exportReportBtn').addEventListener('click', function() {
        exportCurrentReport();
      });
      
      document.querySelectorAll('#formatSelector button').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('#formatSelector button').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
        });
      });
      
      // Add event listeners for saved reports actions
      document.querySelectorAll('.run-report-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const reportId = this.closest('tr').dataset.reportId;
          runSavedReport(reportId);
        });
      });
      
      document.querySelectorAll('.edit-report-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const reportId = this.closest('tr').dataset.reportId;
          editSavedReport(reportId);
        });
      });
      
      document.querySelectorAll('.delete-report-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const reportId = this.closest('tr').dataset.reportId;
          deleteSavedReport(reportId);
        });
      });
    });
    
    // Initialize all charts
    function initCharts() {
      // Branch Performance Chart
      const branchCtx = document.getElementById('branchPerformanceChart').getContext('2d');
      charts.branchPerformance = new Chart(branchCtx, {
        type: 'bar',
        data: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
          datasets: [{
            label: 'Deposits',
            data: [12000000, 11000000, 13000000, 12500000, 14000000, 15000000],
            backgroundColor: 'rgba(151, 20, 77, 0.7)'
          }, {
            label: 'Withdrawals',
            data: [8000000, 8500000, 9000000, 9500000, 10000000, 10500000],
            backgroundColor: 'rgba(108, 117, 125, 0.7)'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return '₹' + (value / 1000000) + 'M';
                }
              }
            }
          }
        }
      });

      // Account Distribution Chart
      const accountCtx = document.getElementById('accountDistributionChart').getContext('2d');
      charts.accountDistribution = new Chart(accountCtx, {
        type: 'doughnut',
        data: {
          labels: ['Savings', 'Current', 'Fixed Deposit', 'Loan'],
          datasets: [{
            data: [45, 25, 20, 10],
            backgroundColor: [
              'rgba(151, 20, 77, 0.7)',
              'rgba(33, 150, 243, 0.7)',
              'rgba(255, 193, 7, 0.7)',
              'rgba(25, 135, 84, 0.7)'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });

      // Transaction Volume Chart
      const transactionCtx = document.getElementById('transactionVolumeChart').getContext('2d');
      charts.transactionVolume = new Chart(transactionCtx, {
        type: 'line',
        data: {
          labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
          datasets: [{
            label: 'Transactions',
            data: [1200, 1900, 1500, 2100, 1800, 900, 600],
            borderColor: 'rgba(151, 20, 77, 1)',
            backgroundColor: 'rgba(151, 20, 77, 0.1)',
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });

      // Customer Demographics Chart
      const demographicsCtx = document.getElementById('customerDemographicsChart').getContext('2d');
      charts.customerDemographics = new Chart(demographicsCtx, {
        type: 'bar',
        data: {
          labels: ['18-25', '26-35', '36-45', '46-55', '56-65', '65+'],
          datasets: [{
            label: 'Number of Customers',
            data: [120, 450, 380, 280, 180, 150],
            backgroundColor: 'rgba(151, 20, 77, 0.7)'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });

      // Revenue Sources Chart
      const revenueCtx = document.getElementById('revenueSourcesChart').getContext('2d');
      charts.revenueSources = new Chart(revenueCtx, {
        type: 'pie',
        data: {
          labels: ['Account Fees', 'Loan Interest', 'Transaction Fees', 'Investment Services'],
          datasets: [{
            data: [35, 40, 15, 10],
            backgroundColor: [
              'rgba(151, 20, 77, 0.7)',
              'rgba(33, 150, 243, 0.7)',
              'rgba(255, 193, 7, 0.7)',
              'rgba(25, 135, 84, 0.7)'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });

      // Customer Activity Chart
      const activityCtx = document.getElementById('customerActivityChart').getContext('2d');
      charts.customerActivity = new Chart(activityCtx, {
        type: 'line',
        data: {
          labels: ['6 AM', '9 AM', '12 PM', '3 PM', '6 PM', '9 PM'],
          datasets: [{
            label: 'Mobile App',
            data: [120, 450, 600, 550, 700, 400],
            borderColor: 'rgba(151, 20, 77, 1)',
            backgroundColor: 'rgba(151, 20, 77, 0.1)',
            tension: 0.3,
            fill: true
          }, {
            label: 'Online Banking',
            data: [80, 350, 500, 450, 400, 200],
            borderColor: 'rgba(33, 150, 243, 1)',
            backgroundColor: 'rgba(33, 150, 243, 0.1)',
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
    
    // Update charts based on selected period
    function updateCharts(period) {
      // In a real application, this would fetch new data based on the period
      // For this example, we'll just simulate with different data
      
      const periods = {
        today: ['6 AM', '9 AM', '12 PM', '3 PM', '6 PM', '9 PM'],
        week: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        month: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
        quarter: ['Month 1', 'Month 2', 'Month 3'],
        year: ['Q1', 'Q2', 'Q3', 'Q4']
      };
      
      const labels = periods[period] || periods.month;
      
      // Update transaction volume chart
      charts.transactionVolume.data.labels = labels;
      charts.transactionVolume.data.datasets[0].data = Array(labels.length).fill().map(() => Math.floor(Math.random() * 2000) + 500);
      charts.transactionVolume.update();
      
      // Update branch performance chart
      charts.branchPerformance.data.labels = labels;
      charts.branchPerformance.data.datasets[0].data = Array(labels.length).fill().map(() => Math.floor(Math.random() * 10000000) + 5000000);
      charts.branchPerformance.data.datasets[1].data = Array(labels.length).fill().map(() => Math.floor(Math.random() * 8000000) + 3000000);
      charts.branchPerformance.update();
      
      showToast(`Charts updated for ${period} period`, 'success');
    }
    
    // Generate custom report
    function generateReport() {
      const reportType = document.getElementById('reportType').value;
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const groupBy = document.getElementById('groupBy').value;
      
      const format = document.querySelector('#formatSelector button.active').dataset.format;
      
      // Generate the report data
      let reportData;
      if (sampleReportData[reportType]) {
        reportData = sampleReportData[reportType];
      } else {
        // Create generic report data
        reportData = [
          ['Period', 'Value 1', 'Value 2', 'Value 3'],
          ['Q1', 1000, 2000, 1500],
          ['Q2', 1200, 2200, 1700],
          ['Q3', 1400, 2400, 1900],
          ['Q4', 1600, 2600, 2100]
        ];
      }
      
      // Export based on format
      if (format === 'excel') {
        exportToExcel(reportData, `${reportType.replace(/\s+/g, '_')}_${startDate}_to_${endDate}`);
      } else if (format === 'csv') {
        exportToCSV(reportData, `${reportType.replace(/\s+/g, '_')}_${startDate}_to_${endDate}`);
      } else {
        // PDF would require additional libraries
        showToast('PDF export would require additional setup', 'info');
      }
      
      showToast(`Generated ${reportType} report from ${startDate} to ${endDate}`, 'success');
    }
    
    // Export current report
    function exportCurrentReport() {
      const period = document.querySelector('#periodSelector button.active').dataset.period;
      
      // Create report data based on current view
      const reportData = [
        ['Metric', 'Value', 'Change'],
        ['New Accounts', 142, '+12%'],
        ['Total Deposits', '₹8.2M', '+5.4%'],
        ['Loan Disbursed', '₹3.5M', '-2.1%'],
        ['Transactions', 1245, '+8.7%']
      ];
      
      exportToExcel(reportData, `DigiBank_${period}_Report_${formatDate(new Date())}`);
      showToast(`Exported ${period} report`, 'success');
    }
    
    // Run saved report
    function runSavedReport(reportId) {
      const reportRow = document.querySelector(`#savedReportsTable tr[data-report-id="${reportId}"]`);
      const reportName = reportRow.cells[0].textContent;
      
      if (sampleReportData[reportName]) {
        exportToExcel(sampleReportData[reportName], reportName.replace(/\s+/g, '_'));
        showToast(`Running report: ${reportName}`, 'success');
      } else {
        showToast(`Report data not found for: ${reportName}`, 'warning');
      }
    }
    
    // Edit saved report
    function editSavedReport(reportId) {
      const reportRow = document.querySelector(`#savedReportsTable tr[data-report-id="${reportId}"]`);
      const reportName = reportRow.cells[0].textContent;
      
      // In a real application, this would open a modal for editing
      showToast(`Editing report: ${reportName}`, 'info');
      
      // Simulate opening an edit dialog
      setTimeout(() => {
        const newName = prompt('Enter new report name:', reportName);
        if (newName && newName !== reportName) {
          reportRow.cells[0].textContent = newName;
          showToast(`Report renamed to: ${newName}`, 'success');
        }
      }, 500);
    }
    
    // Delete saved report
    function deleteSavedReport(reportId) {
      const reportRow = document.querySelector(`#savedReportsTable tr[data-report-id="${reportId}"]`);
      const reportName = reportRow.cells[0].textContent;
      
      if (confirm(`Are you sure you want to delete the report "${reportName}"?`)) {
        reportRow.remove();
        showToast(`Deleted report: ${reportName}`, 'success');
      }
    }
    
    // Export to Excel function
    function exportToExcel(data, filename) {
      const ws = XLSX.utils.aoa_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Report");
      XLSX.writeFile(wb, `${filename}.xlsx`);
    }
    
    // Export to CSV function
    function exportToCSV(data, filename) {
      const csvContent = data.map(row => 
        row.map(cell => `"${cell}"`).join(',')
      ).join('\n');
      
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      
      link.setAttribute('href', url);
      link.setAttribute('download', `${filename}.csv`);
      link.style.visibility = 'hidden';
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    
    // Format date for filename
    function formatDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}${month}${day}`;
    }
    
    // Show toast notification
    function showToast(message, type = 'info') {
      const toastContainer = document.querySelector('.toast-container');
      const toastId = 'toast-' + Date.now();
      
      const toast = document.createElement('div');
      toast.className = `toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'warning' ? 'warning' : type === 'error' ? 'danger' : 'info'} border-0`;
      toast.setAttribute('role', 'alert');
      toast.setAttribute('aria-live', 'assertive');
      toast.setAttribute('aria-atomic', 'true');
      toast.id = toastId;
      
      toast.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">
            ${message}
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      `;
      
      toastContainer.appendChild(toast);
      
      const bsToast = new bootstrap.Toast(toast, {
        autohide: true,
        delay: 3000
      });
      
      bsToast.show();
      
      // Remove toast from DOM after it's hidden
      toast.addEventListener('hidden.bs.toast', function() {
        toast.remove();
      });
    }
    
    function logout() {
      alert("Manager logout clicked! Implement logout logic here.");
    }
  </script>
</body>
</html>