<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Set / Change Transaction PIN - DigiBank</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
 
  <!-- Bootstrap CSS & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
 
  <style>
    body { background-color:#f8f9fa; font-family:'Segoe UI', sans-serif; margin:0; min-height:100vh; display:flex; flex-direction:column; }
    /* Sidebar */
    #sidebarMenu.offcanvas-start { width: 250px; }
    #sidebarMenu .offcanvas-body { padding: .5rem 1rem; }
    #sidebarMenu .nav-link { font-size: .9rem; padding:8px 12px; display:flex; align-items:center; gap:8px; color:#333; transition:.2s; }
    #sidebarMenu .nav-link.active { font-weight:700; color:#0B4D83 !important; background-color:#f0d7e0; border-radius:4px; }
    #sidebarMenu .nav-link:hover { color:#7a0f3e; background-color:#f9e5ef; border-radius:4px; }
 
    /* Top Bar */
    .top-bar { background:#0B4D83; color:#fff; display:flex; align-items:center; justify-content:space-between; padding:10px 20px; position:sticky; top:0; z-index:1030; }
    .top-bar h5 { margin:0; font-weight:700; flex-grow:1; text-align:center; }
    .logout-btn { background:transparent; border:1.5px solid #fff; color:#fff; padding:5px 15px; border-radius:4px; font-weight:600; }
    .logout-btn:hover { background:#fff; color:#0B4D83; }
    .top-bar .btn-outline-light { border:1.5px solid #fff; color:#fff; }
 
    /* Logo */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800&display=swap');
    .digi-bank-logo { display:flex; align-items:center; gap:12px; text-decoration:none; transition:.3s; }
    .digi-bank-logo:hover { transform:scale(1.05); }
    .logo-icon { width:50px; height:50px; background:linear-gradient(135deg,#667eea 0%,#764ba2 25%,#f093fb 50%,#4facfe 100%); border-radius:12px; position:relative; box-shadow:0 6px 18px rgba(102,126,234,.3),0 2px 6px rgba(0,0,0,.1); }
    .logo-icon::before { content:''; position:absolute; inset:8px; background:rgba(255,255,255,.95); border-radius:8px; }
    .logo-icon::after { content:'D'; position:absolute; color:transparent; background:linear-gradient(135deg,#667eea,#764ba2); -webkit-background-clip:text; background-clip:text; font-weight:800; font-size:20px; z-index:2; left:50%; top:50%; transform:translate(-50%,-50%); }
    .logo-text { color:#fff; }
    .main-text { font-size:20px; font-weight:800; letter-spacing:-.5px; line-height:1; }
    .digi { background:linear-gradient(135deg,#87CEEB 0%,#98D8E8 25%,#FFF8DC 50%,#87CEFA 100%); -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow:0 0 10px rgba(255,255,255,.3); }
    .bank { color:#fff; margin-left:3px; text-shadow:0 1px 2px rgba(0,0,0,.3); }
    .tagline { font-size:9px; font-weight:600; color:#e8f4f8; letter-spacing:2px; text-transform:uppercase; margin-top:2px; }
 
    /* Page */
    .container-narrow { max-width: 720px; }
    .card { border:none; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.06); }
    .card-header { background:#0B4D83; color:#fff; border-radius:12px 12px 0 0 !important; }
    .btn-primary { background:#0B4D83; border-color:#0B4D83; }
    .btn-primary:hover { background:#7a0f3e; border-color:#7a0f3e; }
    .pin-input { letter-spacing:.4em; text-align:center; font-size:1.1rem; }
    footer.bg-custom { background-color:#0B4D83; }
  </style>
</head>
<body>
 
  <!-- Sidebar -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="sidebarMenuLabel">Welcome, {{ user.name }} ! ({{ user.role }})</h5>
      <button class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="nav flex-column">
        <li class="nav-item mb-2"><a class="nav-link text-dark" href="{{ url_for('dashboard') }}"><i class="bi bi-speedometer2 me-2"></i> Home</a></li>
        <li class="nav-item mb-2"><a class="nav-link text-dark" href="{{ url_for('viewaccounts') }}"><i class="bi bi-person-lines-fill me-2"></i> View Accounts</a></li>
        <li class="nav-item mb-2"><a class="nav-link text-dark" href="{{ url_for('userdashloan') }}"><i class="bi bi-cash-coin me-2"></i> Loans</a></li>
        <li class="nav-item mb-2"><a class="nav-link text-dark" href="{{ url_for('Txnhistory') }}"><i class="bi bi-clock-history me-2"></i> Transaction History</a></li>
        <li class="nav-item mb-2"><a class="nav-link text-dark" href="{{ url_for('accountbal') }}"><i class="bi bi-wallet2 me-2"></i> Check Balance</a></li>
        <li class="nav-item mb-2"><a class="nav-link text-dark" href="{{ url_for('profile') }}"><i class="bi bi-gift-fill me-2"></i> Profile</a></li>
        <li class="nav-item mb-2"><a class="nav-link text-dark" href="{{ url_for('paybill') }}"><i class="bi bi-credit-card me-2"></i> Pay Bill</a></li>
      </ul>
    </div>
  </div>
 
  <!-- Top Bar -->
  <div class="top-bar d-flex align-items-center">
    <button class="btn btn-outline-light btn-sm me-3" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu"><i class="bi bi-list"></i></button>
    <a class="navbar-brand digi-bank-logo" href="{{ url_for('home') }}">
      <div class="logo-icon"></div>
      <div class="logo-text">
        <div class="main-text"><span class="digi">DiGi</span><span class="bank">Bank</span></div>
        <div class="tagline">Smart Banking</div>
      </div>
    </a>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color:#0B4D83; width:100%;">
      <div class="container-fluid">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="{{ url_for('dashboard') }}">My Activities</a></li>
            <!-- Open Account -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="accountDropdown" role="button" data-bs-toggle="dropdown">Open Account</a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="{{ url_for('open_account') }}">Savings Account</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_account') }}">Salary Account</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_account') }}">Current Account</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_account') }}">Safe Custody Account</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_account') }}">Pension Account</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_account') }}">PMJDY Account</a></li>
              </ul>
            </li>
            <!-- Deposits -->
            <li class="nav-item dropdown">
              <button class="nav-link dropdown-toggle" id="depositsDropdown" data-bs-toggle="dropdown">Deposits</button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="{{ url_for('open_deposits') }}">Digital Fixed Deposits</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_deposits') }}">Fixed Deposits</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_deposits') }}">Recurring Deposits</a></li>
              </ul>
            </li>
            <!-- Loans -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" id="loanDropdown" data-bs-toggle="dropdown">Loans</a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="{{ url_for('userdashloan') }}">Home Loan</a></li>
                <li><a class="dropdown-item" href="{{ url_for('userdashloan') }}">Personal Loan</a></li>
                <li><a class="dropdown-item" href="{{ url_for('userdashloan') }}">Busniness Loan</a></li>
              </ul>
            </li>
            <!-- Cards -->
            <li class="nav-item dropdown">
              <button class="nav-link dropdown-toggle" id="cardDropdown" data-bs-toggle="dropdown" type="button">Cards</button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="{{ url_for('open_cards') }}">Credit Cards</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_cards') }}">Debit Cards</a></li>
                <li><a class="dropdown-item" href="{{ url_for('open_cards') }}">Prepaid Cards</a></li>
              </ul>
            </li>
            <!-- Forex -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" id="forexDropdown" data-bs-toggle="dropdown">Forex</a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Travel Forex Cards</a></li>
                <li><a class="dropdown-item" href="#">Send Money Abroad</a></li>
                <li><a class="dropdown-item" href="#">Send Money India</a></li>
                <li><a class="dropdown-item" href="#">Foregin Currency Exchange</a></li>
              </ul>
            </li>
            <!-- Investments -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" id="investDropdown" data-bs-toggle="dropdown">Investments</a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Public Provident Fund</a></li>
                <li><a class="dropdown-item" href="#">Floating Rate Saving Bonds</a></li>
                <li><a class="dropdown-item" href="#">National Pension System</a></li>
              </ul>
            </li>
          </ul>
          <div class="d-flex align-items-center">
            <h5 class="m-0 me-2 fs-6">Welcome, {{ user.name }} ! ({{ user.role }})</h5>
            <a href="{{ url_for('logout') }}" class="logout-btn btn btn-outline-light btn-sm">Logout</a>
          </div>
        </div>
      </div>
    </nav>
  </div>
 
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="bg-light px-3 py-2 mt-3">
    <ol class="breadcrumb mb-0">
      <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}" style="color:#0B4D83;">Home</a></li>
      <li class="breadcrumb-item"><a href="{{ url_for('paybill') }}" style="color:#0B4D83;">Pay Bills & Utilities</a></li>
      <li class="breadcrumb-item active" aria-current="page" style="color:#0B4D83; font-weight:bold;">Set / Change PIN</li>
    </ol>
  </nav>
 
  <!-- Flash messages -->
  <div class="container container-narrow mt-3">
    {% with msgs = get_flashed_messages(with_categories=true) %}
      {% if msgs %}
        {% for cat, msg in msgs %}
          <div class="alert alert-{{ 'success' if cat=='success' else ('warning' if cat=='warning' else ('info' if cat=='info' else 'danger')) }} alert-dismissible fade show" role="alert">
            {{ msg }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>
 
  <!-- Main Content -->
  <div class="container container-narrow my-4">
    <div class="card">
      <div class="card-header">
        <h5 class="m-0"><i class="bi bi-shield-lock"></i> Set / Change Transaction PIN</h5>
      </div>
      <form method="post" action="{{ url_for('set_pin') }}" class="card-body" id="setPinForm" novalidate>
        <p class="text-muted">This 4-digit PIN will be required before <strong>Check Balance</strong> and <strong>Quick Transfer</strong>.</p>
 
        <div class="mb-3">
          <label class="form-label">Current PIN (if already set)</label>
          <!-- single-backslash or explicit character class -->
          <input type="password" inputmode="numeric" pattern="[0-9]{4}" maxlength="4" class="form-control pin-input" name="current_pin" placeholder="••••">
          <div class="form-text">Leave blank if setting for the first time.</div>
        </div>
 
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">New PIN</label>
            <input id="newPin" type="password" inputmode="numeric" pattern="[0-9]{4}" maxlength="4" class="form-control pin-input" name="new_pin" required placeholder="4 digits">
            <div class="invalid-feedback">Enter a 4-digit numeric PIN.</div>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Confirm PIN</label>
            <input id="confirmPin" type="password" inputmode="numeric" pattern="[0-9]{4}" maxlength="4" class="form-control pin-input" name="confirm_pin" required placeholder="repeat">
            <div class="invalid-feedback">PINs must match.</div>
          </div>
        </div>
 
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="showPinCheck">
          <label class="form-check-label" for="showPinCheck">Show PIN</label>
        </div>
 
        <div class="d-flex gap-2">
          <a href="{{ url_for('paybill') }}" class="btn btn-outline-secondary">Back</a>
          <button type="submit" class="btn btn-primary">Save PIN</button>
        </div>
      </form>
    </div>
  </div>
 
  <!-- Footer -->
  <footer class="bg-custom text-white text-center py-3 mt-auto">
    © 2025 DigiBank. All rights reserved.
  </footer>
 
  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (function(){
      const newPin = document.getElementById('newPin');
      const confirmPin = document.getElementById('confirmPin');
      const showPin = document.getElementById('showPinCheck');
      const form = document.getElementById('setPinForm');
 
      [newPin, confirmPin].forEach(inp=>{
        inp.addEventListener('input', ()=>{
          // keep only digits, hard-cap to 4
          inp.value = inp.value.replace(/\D/g,'').slice(0,4);
          inp.classList.remove('is-invalid');
        });
      });
 
      showPin.addEventListener('change', ()=>{
        const type = showPin.checked ? 'text' : 'password';
        newPin.type = type;
        confirmPin.type = type;
      });
 
      form.addEventListener('submit', (e)=>{
        let ok = true;
        // ✅ JS regex literal uses single backslash
        if(!/^\d{4}$/.test(newPin.value)){ ok = false; newPin.classList.add('is-invalid'); }
        if(confirmPin.value !== newPin.value || !/^\d{4}$/.test(confirmPin.value)){ ok = false; confirmPin.classList.add('is-invalid'); }
        if(!ok){ e.preventDefault(); e.stopPropagation(); }
      });
    })();
  </script>
</body>
</html>
 
 