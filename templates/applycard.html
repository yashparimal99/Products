<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Card Application Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
 
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
 
  <style>
   
    body {
      background-color: #f8f9fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .navbar {
      background-color: #0B4D83;
    }
    .navbar-brand {
      font-weight: bold;
      color: white !important;
    }
    .card {
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .nav-btn {
      background-color: white;
      color: #0B4D83;
      border: 1px solid #0B4D83;
      margin: 0 5px;
    }
    .nav-btn:hover {
      background-color: #0B4D83;
      color: white;
    }
    footer {
      background-color: #0B4D83;
      color: white;
      text-align: center;
      padding: 15px;
      margin-top: 40px;
    }
    /* Breadcrumb styling */
    .breadcrumb-item a {
      color: #0B4D83;
      text-decoration: none;
    }
    .breadcrumb-item a:hover {
      color: #7a103e; /* Slightly darker hover */
    }
  </style>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800&display=swap');
 
.digi-bank-logo {
  display: flex;
  align-items: center;
  gap: 12px;
  text-decoration: none;
  transition: transform 0.3s ease;
}
.digi-bank-logo:hover {
  transform: scale(1.05);
}
.logo-icon {
  width: 50px;
  height: 50px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 100%);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  box-shadow: 0 6px 18px rgba(102, 126, 234, 0.3), 0 2px 6px rgba(0, 0, 0, 0.1);
}
.logo-icon::before {
  content: '';
  position: absolute;
  top: 8px;
  left: 8px;
  right: 8px;
  bottom: 8px;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 8px;
}
.logo-icon::after {
  content: 'D';
  position: absolute;
  color: transparent;
  background: linear-gradient(135deg, #667eea, #764ba2);
  background-clip: text;
  -webkit-background-clip: text;
  font-weight: 800;
  font-size: 20px;
  z-index: 2;
}
.logo-text {
  color: #fff;
}
.main-text {
  font-size: 20px;
  font-weight: 800;
  letter-spacing: -0.5px;
  line-height: 1;
}
.digi {
  background: linear-gradient(135deg, #87CEEB 0%, #98D8E8 25%, #FFF8DC 50%, #87CEFA 100%);
  background-clip: text;
  -webkit-background-clip: text;
  color: transparent;
  text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
}
.bank {
  color: #ffffff;
  margin-left: 3px;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}
.tagline {
  font-size: 9px;
  font-weight: 600;
  color: #e8f4f8;
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-top: 2px;
}

  </style>
</head>
<body>
 
 <!-- Top Bar -->
  <div class="top-bar d-flex align-items-center px-3 py-2" style="background-color:#0B4D83; color:white;">
 
 
    <!-- Logo / Image -->
    <!-- ðŸ”½ Custom DigiBank Logo -->
    <a class="navbar-brand digi-bank-logo" href="{{ url_for('home') }}">
      <div class="logo-icon"></div>
      <div class="logo-text">
        <div class="main-text">
          <span class="digi">DiGi</span><span class="bank">Bank</span>
        </div>
        <div class="tagline">Smart Banking</div>
      </div>
    </a>
 
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <!-- Title -->
    <h5 class="flex-grow-1 text-center m-0">Welcome To Cards Agent Dashboard - DigiBank</h5>
 
    <!-- Logout Button -->
    <div class="d-flex align-items-center">
      <h5 class="m-0 me-2 fs-6">Welcome, {{ user.email }} </h5>
      <a href="{{ url_for('logout') }}" class="btn btn-outline-light btn-sm ms-3">
        Logout
      </a>
    </div>
  </div>
 
 
  <nav aria-label="breadcrumb" style="background-color:#f8f9fa; padding:8px 15px; border-radius:4px; margin:10px 20px;">
    <ol class="breadcrumb mt-0">
      <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}" style="color:#0B4D83;">Home</a></li>
      <li class="breadcrumb-item active" aria-current="page" style="color:#0B4D83; font-weight:bold;"> Apply new card
      </li>
    </ol>
  </nav>
 
  <!-- Breadcrumb -->
  <div class="container my-4">
   
 
      <!-- flashes (optional) -->
  {% with msgs = get_flashed_messages(with_categories=true) %}
    {% if msgs %}
      {% for cat,msg in msgs %}
        <div class="alert alert-{{ 'success' if cat=='success' else 'danger' }} alert-dismissible fade show" role="alert">
          {{ msg }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
 
<form action="{{ url_for('agent_apply_card') }}" method="post" id="agentCardForm">
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Customer Email</label>
      <div class="col-sm-9">
        <input type="email" id="custEmail" name="applicant_email" class="form-control" placeholder="customer@email.com" required>
        <small class="text-muted">Weâ€™ll fetch this customerâ€™s accounts automatically.</small>
      </div>
    </div>
 
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Customer Name</label>
      <div class="col-sm-9">
        <input type="text" name="customer_name" class="form-control" required>
      </div>
    </div>
 
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Mobile Number</label>
      <div class="col-sm-9">
        <input type="tel" name="mobile" class="form-control" required>
      </div>
    </div>
 
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Aadhaar Number</label>
      <div class="col-sm-9">
        <input type="text" name="aadharNumber" maxlength="12" class="form-control" required>
      </div>
    </div>
 
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">PAN (optional)</label>
      <div class="col-sm-9">
        <input type="text" name="panNumber" maxlength="10" class="form-control" placeholder="(format not enforced)">
      </div>
    </div>
 
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Card Type</label>
      <div class="col-sm-9">
        <select id="cardType" name="card_type" class="form-select" required>
          <option value="" selected disabled>Select Card Type</option>
          <option value="credit">Credit Card</option>
          <option value="debit">Debit Card</option>
          <option value="prepaid">Prepaid Card</option>
          <option value="forex">Forex Card</option>
        </select>
      </div>
    </div>
 
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Card Network</label>
      <div class="col-sm-9">
        <select name="card_subtype" class="form-select" required>
          <option value="" selected disabled>Select network</option>
          <option value="visa">VISA</option>
          <option value="rupay">RUPAY</option>
          <option value="mastercard">MASTERCARD</option>
        </select>
      </div>
    </div>
 
    <!-- Account (required for debit/prepaid, optional/hidden for credit) -->
    <div class="row mb-3" id="acctRow" style="display:none;">
      <label class="col-sm-3 col-form-label">Customer Account</label>
      <div class="col-sm-9">
        <select id="acctSelect" name="requested_for_account_number" class="form-select">
          <option value="">Select account</option>
        </select>
        <small class="text-muted">Required for Debit/Prepaid. Optional for Credit.</small>
      </div>
    </div>
 
    <!-- Credit-only -->
    <div id="creditBlock" class="border rounded p-3 mb-3 d-none">
      <div class="row mb-3">
        <label class="col-sm-3 col-form-label">CIBIL Score</label>
        <div class="col-sm-3">
          <input type="number" id="cibil" name="cibil_score" class="form-control" min="300" max="900">
        </div>
 
        <label class="col-sm-3 col-form-label">Issue Limit (â‚¹)</label>
        <div class="col-sm-3">
          <input type="text" id="issueLimitDisplay" class="form-control" value="0" readonly>
        </div>
      </div>
 
      <div class="row mb-3">
        <label class="col-sm-3 col-form-label">Monthly Income (â‚¹)</label>
        <div class="col-sm-3">
          <input type="number" name="monthly_income" class="form-control" min="0" step="1">
        </div>
 
        <label class="col-sm-3 col-form-label">Employment Type</label>
        <div class="col-sm-3">
          <select name="employment_type" class="form-select">
            <option value="">Selectâ€¦</option>
            <option value="salaried">Salaried</option>
            <option value="self_employed">Self Employed</option>
            <option value="student">Student</option>
            <option value="retired">Retired</option>
            <option value="other">Other</option>
          </select>
        </div>
      </div>
 
      <div class="alert alert-info mb-0" id="cibilMsg" style="display:none;"></div>
    </div>
 
   <div class="row">
      <div class="col-sm-12 text-center">
        <button type="submit" class="btn btn-digibank px-4 py-2" style="background-color:#0B4D83; border:none; color:white; font-weight:600;">Submit Application</button>
      </div>
  </form>
</div>
 
<script>
  const emailInput  = document.getElementById('custEmail');
  const acctRow     = document.getElementById('acctRow');
  const acctSelect  = document.getElementById('acctSelect');
  const cardTypeSel = document.getElementById('cardType');
  const creditBlock = document.getElementById('creditBlock');
  const cibilInput  = document.getElementById('cibil');
  const limitOut    = document.getElementById('issueLimitDisplay');
  const cibilMsg    = document.getElementById('cibilMsg');
 
  function computeIssueLimit(cibil) {
    if (!Number.isInteger(cibil)) return 0;
    if (cibil < 550) return 0;
    if (cibil < 650) return 20000;
    if (cibil < 700) return 50000;
    if (cibil < 750) return 100000;
    return 200000;
  }
  function formatINR(n) { return new Intl.NumberFormat('en-IN').format(n); }
 
  // Load customer accounts by email
  let acctTimer = null;
  emailInput.addEventListener('input', () => {
    clearTimeout(acctTimer);
    acctTimer = setTimeout(async () => {
      const email = emailInput.value.trim();
      acctSelect.innerHTML = '<option value="">Select account</option>';
      if (!email) return;
      try {
        const res = await fetch(`/api/user-accounts?email=${encodeURIComponent(email)}`);
        const data = await res.json();
        if (data.ok && Array.isArray(data.accounts)) {
          data.accounts.forEach(a => {
            const opt = document.createElement('option');
            opt.value = a.account_number;
            opt.textContent = `${a.account_number} â€” ${a.account_type.toUpperCase()}`;
            acctSelect.appendChild(opt);
          });
        }
      } catch (e) { /* ignore */ }
    }, 400);
  });
 
  function onTypeChange() {
    const t = (cardTypeSel.value || '').toLowerCase();
    const isCredit = t === 'credit';
 
    creditBlock.classList.toggle('d-none', !isCredit);
 
    // Account row visible unless credit
    acctRow.style.display = isCredit ? 'none' : '';
    if (isCredit) {
      acctSelect.removeAttribute('required');
    } else {
      acctSelect.setAttribute('required', 'required');
    }
  }
 
  function onCibilInput() {
    const v = parseInt(cibilInput.value, 10);
    const limit = computeIssueLimit(Number.isInteger(v) ? v : NaN);
    limitOut.value = formatINR(limit);
 
    if (!Number.isInteger(v)) {
      cibilMsg.style.display = 'none';
    } else {
      let txt = '';
      if (v < 550) txt = 'CIBIL very low â€” card may be declined.';
      else if (v < 650) txt = 'Low score â€” tentative limit â‚¹20,000.';
      else if (v < 700) txt = 'Fair score â€” tentative limit â‚¹50,000.';
      else if (v < 750) txt = 'Good score â€” tentative limit â‚¹1,00,000.';
      else txt = 'Excellent score â€” tentative limit â‚¹2,00,000.';
      cibilMsg.textContent = txt;
      cibilMsg.style.display = 'block';
    }
  }
 
  cardTypeSel.addEventListener('change', onTypeChange);
  cibilInput.addEventListener('input', onCibilInput);
 
  onTypeChange();
  onCibilInput();
</script>
 
 
  <!-- Footer -->
  <footer>
    Â© 2024 DigiBank. All rights reserved.
  </footer>
 
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
 
</body>
</html>
 
 
 
 