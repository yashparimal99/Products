<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cash Deposit Approvals - DigiBank Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
 
  <!-- Bootstrap CSS & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
 
  <style>
    body { background:#f8f9fa; font-family:'Segoe UI',sans-serif; }
    .top-bar { background:#0B4D83; color:#fff; padding:10px 20px; position:sticky; top:0; z-index:1030; }
    .logout-btn{ border:1.5px solid #fff; color:#fff; }
    .logout-btn:hover{ background:#fff; color:#0B4D83; }
 
    /* Sidebar Offcanvas */
    #sidebarMenu.offcanvas-start { width: 250px; }
    #sidebarMenu .offcanvas-body { padding: 0.5rem 1rem; }
    #sidebarMenu .nav-link { font-size:0.9rem; padding:8px 12px; display:flex; align-items:center; gap:8px; color:#333; }
    #sidebarMenu .nav-link.active { font-weight:700; color:#0B4D83 !important; background:#f0d7e0; border-radius:4px; }
    #sidebarMenu .nav-link:hover { color:#7a0f3e; background:#f9e5ef; border-radius:4px; }
 
    /* Cards / Tables */
    .page-title { color:#0B4D83; font-weight:800; }
    .card { border:none; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.08); }
    .card-header { background:#0B4D83; color:#fff; border-radius:10px 10px 0 0 !important; }
    .table thead th { background:#f1f5f9; }
    .badge-pending { background:#ffc107; color:#212529; }
    .badge-approved { background:#28a745; }
    .badge-rejected { background:#dc3545; }
 
    .btn-approve { background:#198754; color:#fff; border:none; }
    .btn-approve:hover { filter:brightness(0.95); }
    .btn-reject { background:#dc3545; color:#fff; border:none; }
    .btn-reject:hover { filter:brightness(0.95); }
 
    .search-wrap input { border:1px solid #0B4D83; }
  </style>
 
  <style>
    /* DigiBank logo bits (as used across your UI) */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800&display=swap');
    .digi-bank-logo { display:flex; align-items:center; gap:12px; text-decoration:none; transition:.3s; }
    .digi-bank-logo:hover { transform:scale(1.05); }
    .logo-icon { width:50px; height:50px; background:linear-gradient(135deg,#667eea 0%,#764ba2 25%,#f093fb 50%,#4facfe 100%); border-radius:12px; position:relative; box-shadow:0 6px 18px rgba(102,126,234,.3),0 2px 6px rgba(0,0,0,.1); }
    .logo-icon::before { content:''; position:absolute; inset:8px; background:rgba(255,255,255,.95); border-radius:8px; }
    .logo-icon::after { content:'D'; position:absolute; color:transparent; background:linear-gradient(135deg,#667eea,#764ba2); -webkit-background-clip:text; background-clip:text; font-weight:800; font-size:20px; z-index:2; left:50%; top:50%; transform:translate(-50%,-50%); }
    .logo-text { color:#fff; }
    .main-text { font-size:20px; font-weight:800; letter-spacing:-.5px; line-height:1; }
    .digi { background:linear-gradient(135deg,#87CEEB 0%,#98D8E8 25%,#FFF8DC 50%,#87CEFA 100%); -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow:0 0 10px rgba(255,255,255,.3); }
    .bank { color:#fff; margin-left:3px; text-shadow:0 1px 2px rgba(0,0,0,.3); }
    .tagline { font-size:9px; font-weight:600; color:#e8f4f8; letter-spacing:2px; text-transform:uppercase; margin-top:2px; }
  </style>
</head>
<body>
 
  <!-- Sidebar Offcanvas -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="sidebarMenuLabel">Manager</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="nav flex-column">
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('dashboard') }}">
            <i class="bi bi-speedometer2 me-2"></i> Dashboard
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('managerapprovals') }}">
            <i class="bi bi-people-fill me-2"></i> Manage Approvals
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark active" href="{{ url_for('manager_cash_deposits') }}">
            <i class="bi bi-cash-coin me-2"></i> Cash Deposits
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('transactions_review') }}">
            <i class="bi bi-list-check me-2"></i> Transaction Review
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-dark" href="{{ url_for('manreport') }}">
            <i class="bi bi-graph-up me-2"></i> Reports & Analytics
          </a>
        </li>
      </ul>
    </div>
  </div>
 
  <!-- Top Bar -->
  <div class="top-bar d-flex align-items-center">
    <button class="btn btn-outline-light btn-sm me-3" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu"
      aria-controls="sidebarMenu" aria-label="Toggle sidebar">
      <i class="bi bi-list"></i>
    </button>
 
    <a class="navbar-brand digi-bank-logo" href="{{ url_for('home') }}">
      <div class="logo-icon"></div>
      <div class="logo-text">
        <div class="main-text"><span class="digi">DiGi</span><span class="bank">Bank</span></div>
        <div class="tagline">Smart Banking</div>
      </div>
    </a>
 
    <h5 class="flex-grow-1 text-center m-0">Cash Deposit Approvals</h5>
 
    <div class="d-flex align-items-center">
      <h5 class="m-0 me-2 fs-6">Welcome, {{ user.email }}</h5>
      <a href="{{ url_for('logout') }}" class="logout-btn btn btn-outline-light btn-sm">Logout</a>
    </div>
  </div>
 
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" style="background:#f8f9fa; padding:8px 15px; border-radius:4px; margin:10px 20px;">
    <ol class="breadcrumb mt-0">
      <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}" style="color:#0B4D83;">Home</a></li>
      <li class="breadcrumb-item active" aria-current="page" style="color:#0B4D83; font-weight:bold;">Cash Deposits</li>
    </ol>
  </nav>
 
  <div class="container mb-4">
 
    <!-- Flashes -->
    {% with msgs = get_flashed_messages(with_categories=true) %}
      {% if msgs %}
        {% for cat, msg in msgs %}
          <div class="alert alert-{{ 'success' if cat=='success' else ('warning' if cat=='warning' else 'danger') }} alert-dismissible fade show" role="alert">
            {{ msg }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
 
    <!-- Page Header / Search -->
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h3 class="page-title m-0">Pending Requests</h3>
      <div class="search-wrap">
        <form method="get" class="d-flex" action="{{ url_for('manager_cash_deposits') }}">
          <input type="text" class="form-control form-control-sm me-2" name="q" value="{{ request.args.get('q','') }}"
                 placeholder="Search email / account / req id">
          <button class="btn btn-sm btn-outline-primary" type="submit">Search</button>
        </form>
      </div>
    </div>
 
    <!-- Pending Requests -->
    <div class="card mb-4">
      <div class="card-header d-flex align-items-center justify-content-between">
        <span>Requests awaiting approval</span>
        <span class="badge bg-secondary">{{ pending|length if pending else 0 }}</span>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead>
              <tr>
                <th style="min-width:130px;">Request ID</th>
                <th style="min-width:200px;">Customer</th>
                <th>Account</th>
                <th class="text-center" style="min-width:120px;">Amount (â‚¹)</th>
                <th>Note</th>
                <th style="min-width:120px;">Requested at</th>
                <th>Status</th>
                <th class="text-center" style="min-width:180px;">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% if pending %}
                {% for req in pending %}
                  <tr>
                    <td><code>{{ req.request_id }}</code></td>
                    <td>
                      <div class="fw-semibold">{{ req.customer_name or req.user_name or '-' }}</div>
                      <div class="text-muted small">{{ req.customer_email or req.user_email or '-' }}</div>
                    </td>
                    <td>{{ req.account_number }}</td>
                    <td class="text-center fw-semibold">{{ '%.2f'|format(req.amount or 0) }}</td>
                    <td class="text-truncate" style="max-width:220px;">{{ req.note or '-' }}</td>
                    <td>
                      {{ req.created_at.strftime('%Y-%m-%d %H:%M:%S') if req.created_at else '-' }}
                    </td>
                    <td><span class="badge badge-pending text-uppercase">Pending</span></td>
                    <td class="text-center">
                      <form action="{{ url_for('manager_cash_deposits_decide', req_id=req.id, action='approve') }}" method="post" class="d-inline">
                        <button class="btn btn-approve btn-sm me-1">
                          <i class="bi bi-check-circle me-1"></i>Approve
                        </button>
                      </form>
                      <form action="{{ url_for('manager_cash_deposits_decide', req_id=req.id, action='reject') }}" method="post" class="d-inline">
                        <button class="btn btn-reject btn-sm">
                          <i class="bi bi-x-circle me-1"></i>Reject
                        </button>
                      </form>
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="8" class="text-center text-muted py-4">No pending requests.</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
 
    <!-- Recent Decisions -->
    <div class="d-flex align-items-center justify-content-between mb-2">
      <h3 class="page-title m-0">Recent Decisions</h3>
    </div>
 
    <div class="card">
      <div class="card-header">Latest approved/rejected</div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead>
              <tr>
                <th style="min-width:130px;">Request ID</th>
                <th style="min-width:200px;">Customer</th>
                <th>Account</th>
                <th class="text-centre">Amount (â‚¹)</th>
                <th>Note</th>
                <th style="min-width:120px;">Updated</th>
                <th>Status</th>
                <th>Txn ID</th>
              </tr>
            </thead>
            <tbody>
              {% if recent %}
                {% for r in recent %}
                  <tr>
                    <td><code>{{ r.request_id }}</code></td>
                    <td>
                      <div class="fw-semibold">{{ r.customer_name or r.user_name or '-' }}</div>
                      <div class="text-muted small">{{ r.customer_email or r.user_email or '-' }}</div>
                    </td>
                    <td>{{ r.account_number }}</td>
                    <td class="text-centre fw-semibold">{{ '%.2f'|format(r.amount or 0) }}</td>
                    <td class="text-truncate" style="max-width:220px;">{{ r.note or '-' }}</td>
                    <td>
                      {% set dt = r.updated_at or r.created_at %}
                      {{ dt.strftime('%Y-%m-%d %H:%M:%S') if dt else '-' }}
                    </td>
                    <td>
                      {% if r.status == 'approved' %}
                        <span class="badge badge-approved text-uppercase">Approved</span>
                      {% elif r.status == 'rejected' %}
                        <span class="badge badge-rejected text-uppercase">Rejected</span>
                      {% else %}
                        <span class="badge badge-pending text-uppercase">{{ r.status }}</span>
                      {% endif %}
                    </td>
                    <td class="text-muted"><code>{{ r.txn_id or '-' }}</code></td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="8" class="text-center text-muted py-4">No recent decisions.</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
 
  </div>
 
  <footer class="text-white text-center py-3 mt-auto" style="background:#0B4D83;">Â© 2025 DigiBank. All rights reserved.</footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
 
 