<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Card Application - DigiBank</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body { background-color:#f8f9fa; font-family:'Segoe UI',sans-serif; }
    #sidebarMenu.offcanvas-start { width: 250px; }
    .top-bar { background:#97144D; color:#fff; padding:10px 20px; position:sticky; top:0; z-index:1030; }
    .logout-btn{ border:1.5px solid #fff; color:#fff; }
    .logout-btn:hover{ background:#fff; color:#97144D; }
    .btn-digibank { background:#97144D; color:#fff; border:none; }
    .btn-digibank:hover { background:#7a0f3e; }
    .form-control, .form-select { border:0.5px solid #97144D; }
  </style>
</head>
<body>
 
<!-- Sidebar -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="sidebarMenuLabel">User</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <ul class="nav flex-column">
      <li class="nav-item mb-2">
        <a class="nav-link text-dark active" href="{{ url_for('dashboard') }}"><i class="bi bi-speedometer2 me-2"></i> Home</a>
      </li>
      <li class="nav-item mb-2">
        <a class="nav-link text-dark" href="{{ url_for('viewaccounts') }}"><i class="bi bi-person-lines-fill me-2"></i> View Accounts</a>
      </li>
      <li class="nav-item mb-2">
        <a class="nav-link text-dark" href="{{ url_for('Txnhistory') }}"><i class="bi bi-clock-history me-2"></i> Transaction History</a>
      </li>
      <li class="nav-item mb-2">
        <a class="nav-link text-dark" href="{{ url_for('accountbal') }}"><i class="bi bi-wallet2 me-2"></i> Check Balance</a>
      </li>
      <li class="nav-item mb-2">
        <a class="nav-link text-dark" href="{{ url_for('paybill') }}"><i class="bi bi-credit-card me-2"></i> Pay Bill</a>
      </li>
    </ul>
  </div>
</div>
 
<!-- Top Bar -->
<div class="top-bar d-flex align-items-center">
  <button class="btn btn-outline-light btn-sm me-3" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu"
    aria-controls="sidebarMenu" aria-label="Toggle sidebar"><i class="bi bi-list"></i></button>
 
  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color:#97144D; width:100%;">
    <div class="container-fluid">
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
 
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="accountDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Open Account</a>
            <ul class="dropdown-menu" aria-labelledby="accountDropdown">
              <li><a class="dropdown-item" href="{{ url_for('savingform') }}">Savings Account</a></li>
              <li><a class="dropdown-item" href="{{ url_for('open_account') }}">Salary Account</a></li>
              <li><a class="dropdown-item" href="{{ url_for('open_account') }}">Current Account</a></li>
              <li><a class="dropdown-item" href="{{ url_for('open_account') }}">Safe Custody Account</a></li>
              <li><a class="dropdown-item" href="{{ url_for('open_account') }}">Pension Account</a></li>
              <li><a class="dropdown-item" href="{{ url_for('open_account') }}">PMJDY Account</a></li>
            </ul>
          </li>
 
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="depositsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Deposits</a>
            <ul class="dropdown-menu" aria-labelledby="depositsDropdown">
              <li><a class="dropdown-item" href="{{ url_for('open_deposits') }}">Digital Fixed Deposits</a></li>
              <li><a class="dropdown-item" href="{{ url_for('open_deposits') }}">Fixed Deposits</a></li>
              <li><a class="dropdown-item" href="{{ url_for('open_deposits') }}">Recurring Deposits</a></li>
            </ul>
          </li>
 
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="loansDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Loans</a>
            <ul class="dropdown-menu" aria-labelledby="loansDropdown">
              <li><a class="dropdown-item" href="{{ url_for('home_loan') }}">Home Loan</a></li>
              <li><a class="dropdown-item" href="{{ url_for('personal_loan') }}">Personal Loan</a></li>
              <li><a class="dropdown-item" href="{{ url_for('Business_loan') }}">Business Loan</a></li>
            </ul>
          </li>
 
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="cardsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Cards</a>
            <ul class="dropdown-menu" aria-labelledby="cardsDropdown">
              <li><a class="dropdown-item" href="{{ url_for('open_cards', preset='credit') }}">Credit Cards</a></li>
              <li><a class="dropdown-item" href="{{ url_for('open_cards', preset='debit') }}">Debit Cards</a></li>
              <li><a class="dropdown-item" href="{{ url_for('open_cards', preset='prepaid') }}">Prepaid Cards</a></li>
            </ul>
          </li>
 
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="forexDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Forex</a>
            <ul class="dropdown-menu" aria-labelledby="forexDropdown">
              <li><a class="dropdown-item" href="{{ url_for('travel_forex') }}">Travel Forex Cards</a></li>
              <li><a class="dropdown-item" href="{{ url_for('send_money_abroad') }}">Send Money Abroad</a></li>
              <li><a class="dropdown-item" href="{{ url_for('send_money_india') }}">Send Money India</a></li>
              <li><a class="dropdown-item" href="{{ url_for('currency_exchange') }}">Foreign Currency Exchange</a></li>
            </ul>
          </li>
 
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="investDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Investments</a>
            <ul class="dropdown-menu" aria-labelledby="investDropdown">
              <li><a class="dropdown-item" href="{{ url_for('pfinvest') }}">Public Provident Fund</a></li>
              <li><a class="dropdown-item" href="{{ url_for('pfinvest') }}">Floating Rate Saving Bonds</a></li>
              <li><a class="dropdown-item" href="{{ url_for('pfinvest') }}">National Pension System</a></li>
            </ul>
          </li>
        </ul>
 
        <div class="d-flex align-items-center">
          <h5 class="m-0 me-2 fs-6">Welcome, {{ user.name if user else '' }}!</h5>
          <a href="{{ url_for('logout') }}" class="logout-btn btn btn-outline-light btn-sm">Logout</a>
        </div>
      </div>
    </div>
  </nav>
</div>
 
<!-- Form -->
<div class="container my-5">
  <h3 class="mb-4" style="color:#97144D;">Card Application Form</h3>
 
  <!-- flashes (optional) -->
  {% with msgs = get_flashed_messages(with_categories=true) %}
    {% if msgs %}
      {% for cat,msg in msgs %}
        <div class="alert alert-{{ 'success' if cat=='success' else 'danger' }} alert-dismissible fade show" role="alert">
          {{ msg }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
 
   
 
   <form action="{{ url_for('open_cards') }}" method="post" id="cardForm">
    <div class="row mb-3">
      <label class="col-sm-2 col-form-label">First Name</label>
      <div class="col-sm-4"><input type="text" name="first_name" class="form-control" required></div>
      <label class="col-sm-2 col-form-label">Middle Name</label>
      <div class="col-sm-4"><input type="text" name="middle_name" class="form-control"></div>
    </div>
 
    <div class="row mb-3">
      <label class="col-sm-2 col-form-label">Last Name</label>
      <div class="col-sm-4"><input type="text" name="last_name" class="form-control" required></div>
      <label class="col-sm-2 col-form-label">Email Address</label>
      <div class="col-sm-4"><input type="email" name="email" class="form-control" value="{{ user.email if user else '' }}" required></div>
    </div>
 
    <div class="row mb-3">
      <label class="col-sm-2 col-form-label">Mobile Number</label>
      <div class="col-sm-4"><input type="tel" name="mobile" class="form-control" required></div>
      <label class="col-sm-2 col-form-label">Aadhar Number</label>
      <div class="col-sm-4"><input type="text" name="Addhar" maxlength="12" class="form-control" required></div>
    </div>
 
    <div class="row mb-3">
      <label class="col-sm-2 col-form-label">Card Type</label>
      <div class="col-sm-4">
        <select id="cardType" name="card_type" class="form-select" required>
          <option value="" disabled {{ 'selected' if not preset else '' }}>Select card type</option>
          <option value="credit"  {{ 'selected' if preset == 'credit' else '' }}>Credit Card</option>
          <option value="debit"   {{ 'selected' if preset == 'debit' else '' }}>Debit Card</option>
          <option value="prepaid" {{ 'selected' if preset == 'prepaid' else '' }}>Prepaid Card</option>
        </select>
      </div>
 
      <label class="col-sm-2 col-form-label">Card Network</label>
      <div class="col-sm-4">
        <select name="card_subtype" class="form-select" required>
          <option value="" disabled selected>Select network</option>
          <option value="visa">VISA</option>
          <option value="rupay">RUPAY</option>
          <option value="mastercard">MASTERCARD</option>
        </select>
      </div>
    </div>
 
    <!-- Account selection (required for debit/prepaid, optional/hidden for credit) -->
    <div class="row mb-3" id="acctRow">
      <label class="col-sm-2 col-form-label">Account Number</label>
      <div class="col-sm-10">
        <select id="acctSelect" name="requested_for_account_number" class="form-select">
          <option value="">Select your account</option>
          {% for a in my_accounts %}
            <option value="{{ a.account_number }}">
              {{ a.account_number }} — {{ a.account_type|upper }}
            </option>
          {% endfor %}
        </select>
        <small class="text-muted">Required for Debit/Prepaid. Optional for Credit.</small>
      </div>
    </div>
 
    <!-- Credit-only inputs -->
    <div id="creditBlock" class="border rounded p-3 mb-3 d-none">
      <div class="row mb-3">
        <label class="col-sm-2 col-form-label">CIBIL Score</label>
        <div class="col-sm-4">
          <input type="number" id="cibil" name="cibil_score" class="form-control" min="300" max="900">
        </div>
 
        <label class="col-sm-2 col-form-label">Issue Limit (₹)</label>
        <div class="col-sm-4">
          <input type="text" id="issueLimitDisplay" class="form-control" value="0" readonly>
        </div>
      </div>
 
      <div class="row mb-3">
        <label class="col-sm-2 col-form-label">Monthly Income (₹)</label>
        <div class="col-sm-4">
          <input type="number" name="monthly_income" class="form-control" min="0" step="1">
        </div>
 
        <label class="col-sm-2 col-form-label">Employment Type</label>
        <div class="col-sm-4">
          <select name="employment_type" class="form-select">
            <option value="">Select…</option>
            <option value="salaried">Salaried</option>
            <option value="self_employed">Self Employed</option>
            <option value="student">Student</option>
            <option value="retired">Retired</option>
            <option value="other">Other</option>
          </select>
        </div>
      </div>
 
      <div class="alert alert-info mb-0" id="cibilMsg" style="display:none;"></div>
    </div>
 
    <div class="row">
      <div class="col-sm-12 text-center">
        <button type="submit" class="btn btn-digibank">Submit Application</button>
      </div>
    </div>
  </form>
</div>
 
<script>
  const cardTypeSel = document.getElementById('cardType');
  const acctRow     = document.getElementById('acctRow');
  const acctSelect  = document.getElementById('acctSelect');
  const creditBlock = document.getElementById('creditBlock');
  const cibilInput  = document.getElementById('cibil');
  const limitOut    = document.getElementById('issueLimitDisplay');
  const cibilMsg    = document.getElementById('cibilMsg');
 
  function computeIssueLimit(cibil) {
    // Mirror server slabs
    if (!Number.isInteger(cibil)) return 0;
    if (cibil < 550) return 0;
    if (cibil < 650) return 20000;
    if (cibil < 700) return 50000;
    if (cibil < 750) return 100000;
    return 200000;
  }
 
  function formatINR(n) {
    return new Intl.NumberFormat('en-IN').format(n);
  }
 
  function onTypeChange() {
    const t = (cardTypeSel.value || '').toLowerCase();
    const isCredit = t === 'credit';
 
    // Show/hide credit block
    creditBlock.classList.toggle('d-none', !isCredit);
 
    // Account required for debit/prepaid; optional for credit
    acctRow.style.display = isCredit ? 'none' : '';
    if (isCredit) {
      acctSelect.removeAttribute('required');
    } else {
      acctSelect.setAttribute('required', 'required');
    }
  }
 
  function onCibilInput() {
    const v = parseInt(cibilInput.value, 10);
    const limit = computeIssueLimit(Number.isInteger(v) ? v : NaN);
    limitOut.value = formatINR(limit);
 
    // Helpful message
    if (!Number.isInteger(v)) {
      cibilMsg.style.display = 'none';
    } else {
      let txt = '';
      if (v < 550) txt = 'CIBIL very low — card may be declined.';
      else if (v < 650) txt = 'Low score — tentative limit ₹20,000.';
      else if (v < 700) txt = 'Fair score — tentative limit ₹50,000.';
      else if (v < 750) txt = 'Good score — tentative limit ₹1,00,000.';
      else txt = 'Excellent score — tentative limit ₹2,00,000.';
      cibilMsg.textContent = txt;
      cibilMsg.style.display = 'block';
    }
  }
 
  cardTypeSel.addEventListener('change', onTypeChange);
  cibilInput.addEventListener('input', onCibilInput);
 
  // init on load (honor preset)
  onTypeChange();
  onCibilInput();
</script>
 
 
<footer class="bg-custom text-white text-center py-3 mt-auto" style="background:#97144D;">© 2025 DigiBank. All rights reserved.</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
 
 